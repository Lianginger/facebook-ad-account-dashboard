(this["webpackJsonpmixxin-dashboard"]=this["webpackJsonpmixxin-dashboard"]||[]).push([[0],{100:function(e,a,t){e.exports=t(204)},204:function(e,a,t){"use strict";t.r(a);var n=t(1),c=t.n(n),r=t(95),o=t.n(r),l=t(43),s=t(54),i=t(40);var u=function(){var e=Object(n.useState)([]),a=Object(i.a)(e,2),t=a[0],r=a[1],o=Object(n.useState)({}),u=Object(i.a)(o,2),d=u[0],m=u[1];return Object(n.useEffect)((function(){window.checkLoginState=function(){window.FB?window.FB.getLoginStatus((function(e){console.log(e),"connected"===e.status?(m((function(e){return Object(s.a)(Object(s.a)({},e),{},{isLogin:!0})})),console.log("fetchUserAndAdAccounts"),window.FB.api("/me?fields=name,picture{url},adaccounts{name,account_id,age}",(function(e){m((function(a){return Object(s.a)(Object(s.a)({},a),{},{name:e.name,pictureURL:e.picture.data.url})})),r(e.adaccounts.data)}))):console.log("Please log into this webpage.")})):console.log("FB not loaded.")},window.checkLoginState(),window.fbAsyncInit=function(){window.FB.init({appId:"2772453809519165",cookie:!0,xfbml:!0,version:"v6.0"}),window.FB.AppEvents.logPageView(),window.checkLoginState()},function(e,a,t){var n,c=e.getElementsByTagName(a)[0];e.getElementById(t)||((n=e.createElement(a)).id=t,n.src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=2772453809519165&autoLogAppEvents=1",c.parentNode.insertBefore(n,c))}(document,"script","facebook-jssdk")}),[]),c.a.createElement("div",{className:"container my-3"},d.pictureURL?c.a.createElement("div",{className:"text-right my-3"},c.a.createElement("div",{className:"btn btn-primary",onClick:function(){return window.FB.logout((function(e){m({}),r([])}))}},c.a.createElement("div",{className:" d-flex align-items-center"},c.a.createElement("img",{src:d.pictureURL,alt:"avatar",className:"rounded-circle",style:{width:"30px"}}),c.a.createElement("span",{className:"mx-2"},"\u767b\u51fa")))):"",c.a.createElement("h1",{className:"text-center my-3"},"\u5ee3\u544a\u5e33\u865f"),c.a.createElement("div",{className:"w-100 text-center my-3"},c.a.createElement("div",{className:"fb-login-button","data-size":"large","data-button-type":"continue_with","data-layout":"default","data-auto-logout-link":"false","data-use-continue-as":"true","data-width":"","data-onlogin":"checkLoginState();","data-scope":"public_profile,email,ads_read,business_management",style:{display:d.isLogin?"none":"block"}})),c.a.createElement("main",{className:"col-12 col-md-6 m-auto"},t.length>0?c.a.createElement("div",{className:"list-group"},t.map((function(e){var a=e.name,t=e.id;return c.a.createElement("button",{key:t,type:"button",className:"list-group-item list-group-item-action",onClick:function(){return Object(l.b)("/facebook-ad-account-dashboard/ad-account/".concat(t))}},a)}))):""))},d=t(62),m=t(55),p=t(99),f=t(75);var b=function(e){var a=e.adAccountId,t=Object(n.useState)(!0),r=Object(i.a)(t,2),o=r[0],s=r[1],u=Object(p.a)({data:[],dateArray:[],leadSpendArray:[],leadArray:[],preLaunchSpendArray:[],roasSpendArray:[],roasArray:[]}),b=Object(i.a)(u,2),h=b[0],y=b[1],E=Object(n.useState)({}),v=Object(i.a)(E,2),g=(v[0],v[1]),A={maintainAspectRatio:!1,hover:{intersect:!1},tooltips:{mode:"index",intersect:!1}},j={labels:Object(m.a)(h.dateArray).reverse(),datasets:[{label:"ROAS",fill:!1,borderColor:"red",pointBackgroundColor:"red",pointHoverBackgroundColor:"red",data:Object(m.a)(h.roasArray).reverse()}]},w={labels:Object(m.a)(h.dateArray).reverse(),datasets:[{label:"CPL",fill:!1,borderColor:"#666",pointBackgroundColor:"#666",pointHoverBackgroundColor:"#666",data:Object(m.a)(h.leadArray).reverse()}]};return Object(n.useEffect)((function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";s(!0),fetch("https://fb-ads-api.herokuapp.com/ad-account/".concat(a,"?").concat(e,"=").concat(t)).then((function(e){return e.json()})).then((function(e){y((function(a){a.data=O(e.data),a.name=e.data[0].account_name})),g(e.paging),s(!1)}))}()}),[a]),Object(n.useEffect)((function(){!function(){var e=Object.keys(h.data),a=[],t=[],n=[],c=[],r=[];Object.values(h.data).map((function(e){if(e["\u9810\u71b1"]){var o=e["\u9810\u71b1"],l=0;o.map((function(e){if(0!==parseInt(e.spend)){var a=parseInt(e.spend);l+=a}})),0!==l?n.push(l):n.push(null)}else n.push(null);if(e["\u524d\u6e2c"]){var s=e["\u524d\u6e2c"],i=0,u=0;s.map((function(e){if(0!==parseInt(e.spend)&&e.actions){var a=parseInt(e.spend),t=e.actions.find((function(e){return"offsite_conversion.fb_pixel_custom"===e.action_type}));i+=a,u+=t?parseInt(t.value):0}})),0!==i&&0!==u?(a.push(i),t.push((i/u).toFixed(2))):(a.push(null),t.push(null))}else a.push(null),t.push(null);if(e["\u5616\u5616"]){var d=e["\u5616\u5616"],m=0,p=0;d.map((function(e){if(0!==parseInt(e.spend)&&e.action_values){var a=parseInt(e.spend),t=e.action_values.find((function(e){return"omni_purchase"===e.action_type}));m+=a,p+=t?parseInt(t.value):0}})),0!==m&&0!==p?(c.push(m),r.push((p/m).toFixed(2))):(c.push(null),r.push(null))}else c.push(null),r.push(null)})),y((function(o){o.dateArray=e,o.leadSpendArray=a,o.leadArray=t,o.preLaunchSpendArray=n,o.roasSpendArray=c,o.roasArray=r}))}()}),[h.data]),c.a.createElement("div",{className:"container my-3"},o?c.a.createElement("div",{className:"text-center my-5"},c.a.createElement("div",{className:"spinner-border text-primary",role:"status"},c.a.createElement("span",{className:"sr-only"},"Loading..."))):c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"btn btn-primary",onClick:function(){return Object(l.b)("/facebook-ad-account-dashboard/")}},"Home"),c.a.createElement("h1",{className:"text-center my-3"},h.name),c.a.createElement("div",{className:"my-2",style:{height:"200px"}},c.a.createElement(f.a,{data:j,options:A})),c.a.createElement("div",{className:"my-2",style:{height:"200px"}},c.a.createElement(f.a,{data:w,options:A})),c.a.createElement("table",{className:"table"},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",{scope:"col"},"Date"),c.a.createElement("th",{scope:"col"},"\u524d\u6e2c\u82b1\u8cbb"),c.a.createElement("th",{scope:"col"},"CPL"),c.a.createElement("th",{scope:"col"},"\u9810\u71b1\u82b1\u8cbb"),c.a.createElement("th",{scope:"col"},"\u4e0a\u7dda\u82b1\u8cbb"),c.a.createElement("th",{scope:"col"},"ROAS"))),c.a.createElement("tbody",null,h.dateArray.map((function(e,a){return c.a.createElement("tr",{key:"daily-adAccount-data-".concat(a)},c.a.createElement("th",null,e),c.a.createElement("td",null,h.leadSpendArray[a]),c.a.createElement("td",null,h.leadArray[a]),c.a.createElement("td",null,h.preLaunchSpendArray[a]),c.a.createElement("td",null,h.roasSpendArray[a]),c.a.createElement("td",null,h.roasArray[a]))}))))));function O(e){var a={};return e.map((function(e){var t=e.date_start,n=function(e){return e.campaign_name.includes("\u9810\u71b1")?"\u9810\u71b1":e.campaign_name.includes("\u524d\u6e2c")?"\u524d\u6e2c":e.campaign_name.includes("\u5616\u5616")?"\u5616\u5616":"none"}(e);a[t]?a[t][n]?a[t][n].push(e):a[t][n]=[e]:a[t]=Object(d.a)({},n,[e])})),a}},h=function(){return c.a.createElement(l.a,{basepath:"/facebook-ad-account-dashboard",primary:!1},c.a.createElement(u,{path:"/"}),c.a.createElement(b,{path:"/ad-account/:adAccountId"}))};t(202);o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(h,null)),document.getElementById("root"))}},[[100,1,2]]]);
//# sourceMappingURL=main.e09d1a70.chunk.js.map