{"version":3,"sources":["utils/utils.js","components/Switch.js","svgs/SvgLogo.js","svgs/SvgArrowLeft.js","features/user/userSlice.js","features/adAccounts/adAccountsSlice.js","containers/HeaderContainer.js","containers/ProjectContainer.js","pages/Home.js","hooks/useGoogleAnalytics.js","pages/AdAccount.js","pages/App.js","reducers/index.js","features/user/userSaga.js","sagas/index.js","index.js"],"names":["format","data","toDollar","toString","replace","toNumber","toProjectTime","split","date","time","substring","toPercentage","Number","toFixed","toDate","newDate","Date","year","getFullYear","month","getMonth","slice","getDate","toTime","hours","getHours","minutes","getMinutes","Switch","labelFor","isOn","handleToggle","onColor","title","className","checked","onChange","id","type","style","background","htmlFor","SvgLogo","props","width","height","viewBox","fill","clipPath","d","cx","cy","r","gradientUnits","gradientTransform","stopColor","offset","SvgArrowLeft","fillRule","clipRule","userSlice","createSlice","name","initialState","reducers","setUser","state","action","payload","sagas","fetchUserAndAdAccountsAsync","createAction","actions","adAccountsSlice","setAdAccounts","connect","user","dispatch","bindActionCreators","isHome","useEffect","isLoading","window","checkLoginState","FB","getLoginStatus","res","status","console","log","fbAsyncInit","init","appId","cookie","xfbml","version","AppEvents","logPageView","s","js","fjs","getElementsByTagName","getElementById","createElement","src","parentNode","insertBefore","document","onClick","navigate","role","isNoAuth","isLogin","pictureURL","alt","data-size","data-button-type","data-layout","data-auto-logout-link","data-use-continue-as","data-width","data-onlogin","data-scope","display","ProjectContainer","project","adAccount","gaViewIdMap","leadGAData","useState","countdown","setCountdown","costPerAverageLead","leadTotal","leadSpendTotal","total","preLaunchSpendTotal","fundingCurrentNumber","funding_current","fundingTargetNumber","funding_target","goalPercentage","Math","floor","fundRaisingSpendTotalPerFundingCurrent","fundRaisingSpendTotal","countdownInterval","setInterval","t","finished_at","distance","getTime","clearInterval","days","backgroundImage","og_image","href","projectId","target","sponsor_count","started_at","adAccounts","isFilter","setIsFilter","filteredAdAccounts","filter","adAccountLive","sort","a","b","campaignStatus","value","path","URL","location","searchParams","get","map","amount_spent","key","opacity","useGoogleAnalytics","reportRequests","fetchCount","tokenClient","setData","gaRequestData","root","method","body","err","result","error","code","Promise","resolve","reject","callback","resp","undefined","requestAccessToken","Error","queryReports","gapi","client","request","then","generateDateToGoal","catch","getToken","retry","reports","rows","totals","dateToGoalMap","length","values","forEach","dimensions","metrics","gapiLoadOkay","gapiLoadFail","gisLoadOkay","gisLoadFail","gapiLoadPromise","gisLoadPromise","load","onerror","google","accounts","oauth2","initTokenClient","client_id","scope","prompt","gapiScript","async","defer","onload","gisScript","appendChild","adAccountId","loading","setLoading","LEAD","tabTopic","setTabTopic","timeZoneOffset","getTimezoneOffset","initialSinceTime","initialUntilTime","initialSinceDate","toISOString","initialUntilDate","timeRangeSince","setTimeRangeSince","timeRangeUntil","setTimeRangeUntil","numberOfReload","setNumberOfReload","useImmer","platformId","dateArray","leadSpendDaily","leadDaily","costPerLeadDaily","preLaunchSpendDaily","fundRaisingSpendDaily","adsDirectFundRaisingTotal","adsDirectFundRaisingDaily","adsDirectRoasDaily","fundRaisingTotal","fundRaisingDaily","orderCountTotal","orderCountDaily","totalRoasDaily","brewData","setAdAccount","fundRaisingDateMap","orderCountDateMap","setProject","comment","setComment","updateCommentCallback","useCallback","func","wait","immediate","timeout","context","this","args","arguments","later","apply","callNow","clearTimeout","setTimeout","debounce","fetch","headers","JSON","stringify","updateComment","chatbot","setChatbot","isOpen","totalOrderCount","totalOrderSum","orderStatsDaily","dateToOrderSum","brew","setBrew","chartGlobalOptions","maintainAspectRatio","elements","line","tension","borderWidth","point","radius","hover","intersect","tooltips","mode","fundRaisingLineChartData","labels","projectStartIndex","reverse","datasets","label","borderColor","pointBackgroundColor","pointHoverBackgroundColor","datalabels","color","align","fundRaisingLineChartOptions","scales","yAxes","position","scaleLabel","labelString","xAxes","ticks","index","leadLineChartData","leadLineChartOptions","fontColor","brewLineChartData","brewAdsSpendTotal","brewTotalRoasDaily","brewAdsDirectRoasDaily","spend","push","revenue","brewLineChartOptions","initialGaViewIdMap","setGaViewIdMap","leadGAReportRequests","viewId","dateRanges","startDate","endDate","expression","fetchLeadGACount","setFetchLeadGACount","costPerGALeadDaily","fundRaisingGAReportRequests","fetchFundRaisingGACount","setFetchFundRaisingGACount","fundRaisingGAData","alert","json","business_street","business_street2","rawData","dataMart","date_start","campaignType","campaign_name","includes","toLowerCase","getCampaignType","formatDataMart","chatbotMap","chatbotTotal","date_time","order_audience","order_sum","order_count","orderSum","orderCount","Object","keys","brewAdsRevenueTotal","dateData","adCampaignArray","totalSpend","adCampaign","parseInt","adCampaignSpend","totalLead","adCampaignLeadAction","find","action_type","startsWith","totalRevenue","adCampaignOmniPurchaseAction","action_values","generateChartData","timeline","parse","customize_timeline","fetchFundingData","projectStartDate","findIndex","e","projectStartAt","projectFinishAt","timelineDataMart","fundingData","fundingOfThePreviousDay","orderOfThePreviousDay","entries","fundingToday","orderToday","commentMap","tx","i","setAttribute","scrollHeight","addEventListener","OnInput","textareaAutoResize","topic","max","event","persist","disabled","updateGaViewId","options","padding","cols","data-date","overflowY","handleCommentInputChange","dataset","App","basepath","primary","combineReducers","userReducer","adAccountsReducer","fetchUserAndAdAccountsAsyncSaga","productSaga","put","call","api","response","userData","picture","url","formatAdAccounts","adaccounts","AdAccounts","sortedAdAccountsData","age","campaigns","originalStatus","adCampaignName","newStatus","getAdCampaignStatus","handleAdCampaignStatus","takeLatest","rootSaga","all","userSaga","sagaMiddleware","createSagaMiddleware","store","configureStore","reducer","rootReducer","middleware","run","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.ca91d728.chunk.js","sourcesContent":["export function format(data) {\r\n  return {\r\n    toDollar() {\r\n      return !data && data !== 0\r\n        ? ''\r\n        : `$ ${data.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}`\r\n    },\r\n    toNumber() {\r\n      return !data && data !== 0\r\n        ? ''\r\n        : data.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\r\n    },\r\n    toProjectTime() {\r\n      const [date, time] = data.split('T')\r\n      return !data ? '' : `${date} ${time.substring(0, 5)}`\r\n    },\r\n    toPercentage() {\r\n      if (!data) {\r\n        return ''\r\n      }\r\n      return `${Number(data * 100).toFixed(1)} %`\r\n    },\r\n    toDate() {\r\n      // input unix time\r\n      const newDate = new Date(data)\r\n      const year = newDate.getFullYear()\r\n      const month = ('0' + (newDate.getMonth() + 1)).slice(-2)\r\n      const date = ('0' + newDate.getDate()).slice(-2)\r\n      return !data ? '' : `${year}-${month}-${date}`\r\n    },\r\n    toTime() {\r\n      // input unix time\r\n      const newDate = new Date(data)\r\n      const hours = ('0' + newDate.getHours()).slice(-2)\r\n      const minutes = ('0' + newDate.getMinutes()).slice(-2)\r\n      return !data ? '' : `${hours}:${minutes}`\r\n    },\r\n  }\r\n}\r\n\r\nexport function debounce(func, wait, immediate) {\r\n  let timeout\r\n  return function () {\r\n    const context = this\r\n    const args = arguments\r\n    const later = function () {\r\n      timeout = null\r\n      if (!immediate) {\r\n        func.apply(context, args)\r\n      }\r\n    }\r\n    const callNow = immediate && !timeout\r\n    clearTimeout(timeout)\r\n    timeout = setTimeout(later, wait)\r\n    if (callNow) {\r\n      func.apply(context, args)\r\n    }\r\n  }\r\n}\r\n\r\nexport function textareaAutoResize() {\r\n  const tx = document.getElementsByTagName('textarea')\r\n  for (let i = 0; i < tx.length; i++) {\r\n    tx[i].setAttribute(\r\n      'style',\r\n      'height:' + tx[i].scrollHeight + 'px;overflow-y:hidden;'\r\n    )\r\n    tx[i].addEventListener('input', OnInput, false)\r\n  }\r\n\r\n  function OnInput() {\r\n    this.style.height = 'auto'\r\n    this.style.height = this.scrollHeight + 'px'\r\n  }\r\n}\r\n","import React from 'react'\r\nimport './Switch.css'\r\n\r\nconst Switch = ({ labelFor, isOn, handleToggle, onColor, title }) => {\r\n  return (\r\n    <>\r\n      <div className='switch-container'>\r\n        <input\r\n          checked={isOn}\r\n          onChange={handleToggle}\r\n          className='react-switch-checkbox'\r\n          id={'react-switch-' + labelFor}\r\n          type='checkbox'\r\n        />\r\n        <label\r\n          style={{ background: isOn && onColor }}\r\n          className='react-switch-label'\r\n          htmlFor={'react-switch-' + labelFor}\r\n        >\r\n          <span className={`react-switch-button`} />\r\n        </label>\r\n        <span>只顯示活躍廣告帳戶</span>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Switch\r\n","import * as React from 'react'\r\n\r\nfunction SvgLogo(props) {\r\n  return (\r\n    <svg width={324} height={403} viewBox='0 0 324 403' fill='none' {...props}>\r\n      <g clipPath='url(#prefix__clip0)'>\r\n        <path\r\n          d='M236.243 182.778c4.452 10.789 3.498 23.482-3.497 33.954-11.129 16.5-33.704 20.943-50.556 9.837l-20.031-13.328-20.031-13.645c-16.534-11.106-39.109-6.664-50.556 9.837-6.995 10.154-7.949 22.847-3.497 33.636 0 0 0 .318.317.318 10.493 25.385 32.432 42.521 57.551 47.915 15.262 3.174 31.478 2.222 47.058-4.125 5.087-2.221 9.857-4.76 14.308-7.616 30.524-20.943 43.56-60.926 28.934-96.783z'\r\n          fill='url(#prefix__paint0_radial)'\r\n        />\r\n        <path\r\n          d='M161.841 302.726c-22.893 0-46.104-8.885-63.592-26.338-16.852-16.818-26.39-39.348-26.39-63.464 0-23.8 9.22-46.33 26.39-63.465 3.816-3.808 9.857-3.808 13.672 0 3.816 3.808 3.816 9.837 0 13.645-13.354 13.327-20.667 30.78-20.667 49.502s7.313 36.492 20.667 49.503c27.345 27.289 71.859 27.289 99.522 0 27.344-27.29 27.344-71.715 0-99.322l-56.279-55.532c-3.816-3.808-3.816-9.837 0-13.645 3.815-3.808 9.857-3.808 13.672 0l56.597 56.484c34.975 34.905 34.975 91.706 0 126.611-17.488 17.453-40.381 26.021-63.592 26.021z'\r\n          fill='#0A2240'\r\n        />\r\n        <path\r\n          d='M162.477 255.445c-5.405 0-9.857-4.443-9.857-9.837v-82.504l-41.334-41.252c-27.98-27.924-27.98-72.984 0-100.909C124.64 7.298 142.763 0 161.841 0s37.201 7.298 50.555 20.943c13.037 13.01 20.668 30.463 20.986 48.868v.317c0 14.28-3.18 26.973-9.857 37.444v.318c-2.862 4.442-8.903 6.029-13.354 3.173-4.452-2.856-6.041-8.885-3.18-13.328v-.317c4.452-7.298 6.995-16.5 6.995-26.972-.318-13.328-5.723-26.02-15.262-35.54-9.856-9.837-22.893-15.232-36.883-15.232-13.99 0-27.026 5.395-36.883 15.232-20.032 19.99-20.032 52.992 0 72.984l44.514 44.425c1.908 1.904 2.862 4.442 2.862 6.981v86.629c0 5.077-4.452 9.52-9.857 9.52zM27.98 156.123c2.544 2.538 3.816 6.664 3.816 12.375v36.81c0 4.125 2.226 6.664 6.041 6.664h3.498c4.133 0 7.63 2.221 7.63 7.615 0 5.395-3.497 7.616-7.63 7.616H32.75c-10.493 0-18.442-6.346-18.442-19.039v-38.079c0-4.76-1.272-7.616-2.861-9.202-1.59-1.587-3.498-1.904-5.406-2.222-4.451-.634-6.359-3.173-6.359-7.615 0-4.443 1.908-6.664 6.36-7.616 1.907-.317 4.133-.952 5.723-2.539 1.59-1.586 2.543-4.125 2.543-8.567v-38.08c0-12.692 7.95-19.038 18.442-19.038h8.585c4.133 0 7.63 2.22 7.63 7.615s-3.497 7.616-7.63 7.616h-3.18c-3.816 0-6.041 2.539-6.041 6.664v36.809c0 5.712-1.59 9.52-3.816 12.059-2.543 2.855-6.04 4.442-8.585 4.442v.317c2.544 1.27 6.042 2.539 8.267 5.395zM304.287 151.363c-2.544-.317-6.042-1.587-8.585-4.443-2.226-2.538-3.816-6.663-3.816-12.058V97.735c0-4.125-2.226-6.663-6.041-6.663h-3.498c-4.133 0-7.631-2.222-7.631-7.616 0-5.395 3.498-7.616 7.631-7.616h8.585c10.493 0 18.442 6.347 18.442 19.04v38.078c0 4.443.954 7.299 2.544 8.568 1.589 1.587 3.497 2.221 5.723 2.539 4.451.952 6.359 3.173 6.359 7.615 0 4.443-1.908 6.981-6.359 7.616-1.908.317-3.816.635-5.405 2.221-1.59 1.587-2.862 4.126-2.862 9.203v38.078c0 12.693-7.949 19.04-18.442 19.04h-8.585c-4.133 0-7.631-2.221-7.631-7.616 0-5.394 3.498-7.616 7.631-7.616h3.498c3.815 0 6.041-2.538 6.041-6.663v-37.445c0-5.711 1.59-9.519 3.816-12.058 2.543-3.173 6.041-4.442 8.585-5.077zM54.371 388.403c0 8.885-8.267 14.597-20.35 14.597-9.538 0-16.215-3.173-18.759-9.202-1.272-3.174.954-6.347 4.451-6.347h.636c1.908 0 3.816.952 4.452 2.856 1.272 2.856 4.451 4.443 9.857 4.443 6.04 0 9.538-2.222 9.538-6.03 0-11.74-28.934-2.538-28.934-22.847 0-8.567 7.949-14.597 19.395-14.597 8.903 0 15.263 3.174 17.806 8.885 1.272 3.174-.954 6.347-4.451 6.347h-.636c-1.908 0-3.816-.952-4.452-2.856-1.271-2.856-4.133-4.125-8.584-4.125-6.042 0-8.903 2.221-8.903 5.712 0 11.423 28.934 2.221 28.934 23.164zM84.26 384.278v13.328c0 2.538-2.227 4.759-4.77 4.759h-.954c-2.544 0-4.77-2.221-4.77-4.759v-13.645c0-.952-.318-1.587-.636-2.222l-13.036-23.164c-1.907-3.173.636-6.981 4.134-6.981 1.59 0 3.18.952 4.133 2.538l10.81 19.674 10.493-19.674c.954-1.586 2.544-2.538 4.134-2.538 3.497 0 5.723 3.808 4.133 6.981l-13.354 23.482c-.318.634-.318 1.586-.318 2.221zM123.05 379.835c0-2.221 1.908-4.125 4.134-4.125h1.589c5.088 0 7.949-3.173 7.949-7.933 0-4.442-2.861-7.616-7.949-7.616h-6.041c-2.544 0-4.769 2.222-4.769 4.76v33.002c0 2.538-2.226 4.76-4.77 4.76h-.954c-2.543 0-4.769-2.222-4.769-4.76v-38.714c0-4.125 3.498-7.615 7.631-7.615h13.354c11.447 0 18.442 5.712 18.442 16.183 0 10.472-6.995 16.184-18.442 16.184h-1.589c-1.908 0-3.816-1.904-3.816-4.126zM197.77 356.354v41.569c0 2.538-2.225 4.76-4.769 4.76h-.954c-2.544 0-4.769-2.222-4.769-4.76v-16.818h-22.575v16.818c0 2.538-2.226 4.76-4.77 4.76h-.954c-2.543 0-4.769-2.222-4.769-4.76v-41.569c0-2.539 2.226-4.76 4.769-4.76h.954c2.544 0 4.77 2.221 4.77 4.76v15.866h22.893v-15.866c0-2.539 2.225-4.76 4.769-4.76h.954c2.226 0 4.451 2.221 4.451 4.76zM206.673 377.297c0-15.866 10.811-26.021 25.437-26.021 14.626 0 25.437 9.837 25.437 25.704 0 16.183-10.811 26.02-25.437 26.02-14.626 0-25.437-9.837-25.437-25.703zm40.381-.317c0-10.789-6.677-17.136-14.944-17.136-8.267 0-14.944 6.347-14.944 17.136 0 10.789 6.677 17.135 14.944 17.135 8.267 0 14.944-6.346 14.944-17.135zM309.056 356.354v41.569c0 2.538-2.226 4.76-4.769 4.76h-2.226c-1.59 0-3.18-.952-3.816-2.222l-21.939-33.318v30.78c0 2.538-2.226 4.76-4.769 4.76h-.636c-2.544 0-4.769-2.222-4.769-4.76v-41.569c0-2.539 2.225-4.76 4.769-4.76h2.226c1.589 0 3.179.952 3.815 2.221l21.939 33.636v-30.78c0-2.539 2.226-4.76 4.77-4.76h.636c2.861-.317 4.769 1.904 4.769 4.443z'\r\n          fill='#0A2240'\r\n        />\r\n      </g>\r\n      <defs>\r\n        <radialGradient\r\n          id='prefix__paint0_radial'\r\n          cx={0}\r\n          cy={0}\r\n          r={1}\r\n          gradientUnits='userSpaceOnUse'\r\n          gradientTransform='matrix(128.005 0 0 127.749 161.502 161.916)'\r\n        >\r\n          <stop stopColor='#FFB819' />\r\n          <stop offset={1} stopColor='#FF48CC' />\r\n        </radialGradient>\r\n        <clipPath id='prefix__clip0'>\r\n          <path fill='#fff' d='M0 0h324v403H0z' />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  )\r\n}\r\n\r\nexport default SvgLogo\r\n","import * as React from 'react'\r\n\r\nfunction SvgArrowLeft(props) {\r\n  return (\r\n    <svg width={24} height={24} viewBox='0 0 24 24' fill='none' {...props}>\r\n      <path\r\n        fillRule='evenodd'\r\n        clipRule='evenodd'\r\n        d='M12.707 5.707a1 1 0 00-1.414-1.414l-7 7a1 1 0 000 1.414l7 7a1 1 0 001.414-1.414L7.414 13H19a1 1 0 100-2H7.414l5.293-5.293z'\r\n      />\r\n    </svg>\r\n  )\r\n}\r\n\r\nexport default SvgArrowLeft\r\n","import { createSlice, createAction } from '@reduxjs/toolkit'\r\n\r\nconst userSlice = createSlice({\r\n  name: 'user',\r\n  initialState: {},\r\n  // reducers support `immer` so you can mutate the state in slice.\r\n  reducers: {\r\n    setUser(state, action) {\r\n      if (!action.payload) {\r\n        return {}\r\n      }\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n      }\r\n    },\r\n  },\r\n})\r\n\r\nuserSlice.sagas = {\r\n  fetchUserAndAdAccountsAsync: createAction('user/fetchUserAndAdAccountsAsync'),\r\n}\r\n\r\nexport const { setUser } = userSlice.actions\r\nexport const { fetchUserAndAdAccountsAsync } = userSlice.sagas\r\nexport default userSlice.reducer\r\n","import { createSlice, createAction } from '@reduxjs/toolkit'\r\n\r\nconst adAccountsSlice = createSlice({\r\n  name: 'adAccounts',\r\n  initialState: {\r\n    data: [],\r\n  },\r\n  // reducers support `immer` so you can mutate the state in slice.\r\n  reducers: {\r\n    setAdAccounts(state, action) {\r\n      if (!action.payload) {\r\n        return { data: [] }\r\n      }\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n      }\r\n    },\r\n  },\r\n})\r\n\r\nexport const { setAdAccounts } = adAccountsSlice.actions\r\nexport default adAccountsSlice.reducer\r\n","import React, { useEffect, useState } from 'react'\r\nimport { navigate } from '@reach/router'\r\nimport { connect } from 'react-redux'\r\nimport { bindActionCreators } from 'redux'\r\nimport { SvgLogo, SvgArrowLeft } from '../svgs'\r\n\r\nimport './HeaderContainer.scss'\r\n\r\nimport {\r\n  fetchUserAndAdAccountsAsync,\r\n  setUser,\r\n} from '../features/user/userSlice'\r\nimport { setAdAccounts } from '../features/adAccounts/adAccountsSlice'\r\n\r\nconst HeaderContainer = ({\r\n  title,\r\n  setAdAccounts,\r\n  user,\r\n  setUser,\r\n  isHome,\r\n  fetchUserAndAdAccountsAsync,\r\n}) => {\r\n  useEffect(() => {\r\n    setUser({ isLoading: true })\r\n    window.checkLoginState = function () {\r\n      window.FB\r\n        ? window.FB.getLoginStatus((res) => {\r\n            setUser({ isLoading: true })\r\n            if (res.status === 'connected') {\r\n              // Logged into your webpage and Facebook.\r\n              // fetchUserAndAdAccounts()\r\n              fetchUserAndAdAccountsAsync()\r\n            } else {\r\n              // Not logged into your webpage or we are unable to tell.\r\n              console.log('Please log into this webpage.')\r\n              setUser({ isLoading: false })\r\n            }\r\n          })\r\n        : console.log('FB not loaded.')\r\n    }\r\n    window.checkLoginState()\r\n\r\n    window.fbAsyncInit = function () {\r\n      window.FB.init({\r\n        appId: '2772453809519165',\r\n        cookie: true,\r\n        xfbml: true,\r\n        version: 'v12.0',\r\n      })\r\n\r\n      window.FB.AppEvents.logPageView()\r\n      window.checkLoginState()\r\n    }\r\n    ;(function (d, s, id) {\r\n      var js,\r\n        fjs = d.getElementsByTagName(s)[0]\r\n      if (d.getElementById(id)) {\r\n        return\r\n      }\r\n      js = d.createElement(s)\r\n      js.id = id\r\n      js.src =\r\n        'https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v12.0&appId=2772453809519165&autoLogAppEvents=1'\r\n      fjs.parentNode.insertBefore(js, fjs)\r\n    })(document, 'script', 'facebook-jssdk')\r\n  }, [])\r\n\r\n  return (\r\n    <header className='header'>\r\n      <div className='header__line-left'>\r\n        {!isHome && (\r\n          <div className='header__back-to-home' onClick={() => navigate('/')}>\r\n            <SvgArrowLeft className='header__arrow-left' />\r\n            <span className='header__back-to-home-text'>Home</span>\r\n          </div>\r\n        )}\r\n        <div className='header__title'>{title}</div>\r\n      </div>\r\n      <SvgLogo className='header__logo' />\r\n      <div className='header__line-right'></div>\r\n      <div className='header__account'>\r\n        {user.isLoading && (\r\n          <div\r\n            className='spinner-border text-primary spinner-border-sm mx-3'\r\n            role='status'\r\n          >\r\n            <span className='sr-only'>Loading...</span>\r\n          </div>\r\n        )}\r\n        {user.isNoAuth && !user.isLoading ? (\r\n          <span className='text-danger'>你沒有權限</span>\r\n        ) : (\r\n          ''\r\n        )}\r\n        {/* Avatar、登出 */}\r\n        {user.isLogin && !user.isLoading ? (\r\n          <div className='text-right'>\r\n            <div\r\n              className='bg-primary rounded'\r\n              onClick={() => {\r\n                setUser(false)\r\n                setAdAccounts(false)\r\n              }}\r\n            >\r\n              <div className='d-flex align-items-center'>\r\n                <span className='mx-2 text-light font-weight-bold'>登出</span>\r\n                <img\r\n                  src={user.pictureURL}\r\n                  alt='avatar'\r\n                  className='rounded'\r\n                  style={{ width: '28px' }}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          ''\r\n        )}\r\n        {/* 臉書登入 */}\r\n        <div className='w-100 text-center'>\r\n          <div\r\n            className='fb-login-button'\r\n            data-size='medium'\r\n            data-button-type='continue_with'\r\n            data-layout='default'\r\n            data-auto-logout-link='false'\r\n            data-use-continue-as='true'\r\n            data-width=''\r\n            data-onlogin='checkLoginState();'\r\n            data-scope='public_profile,email,ads_read'\r\n            style={{\r\n              display:\r\n                user.isLogin || user.isLoading || user.isNoAuth\r\n                  ? 'none'\r\n                  : 'block',\r\n            }}\r\n          ></div>\r\n        </div>\r\n      </div>\r\n    </header>\r\n  )\r\n}\r\n\r\nconst mapStateToProps = ({ user }) => ({\r\n  user,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch) =>\r\n  bindActionCreators(\r\n    {\r\n      fetchUserAndAdAccountsAsync,\r\n      setUser,\r\n      setAdAccounts,\r\n    },\r\n    dispatch\r\n  )\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(HeaderContainer)\r\n","import React, { useState } from 'react'\r\nimport { format } from '../utils/utils'\r\nimport './ProjectContainer.scss'\r\n\r\nconst ProjectContainer = ({ project, adAccount, gaViewIdMap, leadGAData }) => {\r\n  const LEAD = 'lead'\r\n  const [countdown, setCountdown] = useState('')\r\n\r\n  const costPerAverageLead =\r\n    adAccount.leadTotal > 0\r\n      ? Number(adAccount.leadSpendTotal / adAccount.leadTotal).toFixed(1)\r\n      : '-'\r\n\r\n  if (!project.id) {\r\n    return (\r\n      <div className=\"project__ad-stats row\">\r\n        <div className=\"col-12 col-sm-4 ad-stats__list\">\r\n          <div className=\"ad-stats__key\">名單數</div>\r\n          <div className=\"ad-stats__value\">\r\n            {gaViewIdMap[LEAD] && leadGAData.total\r\n              ? format(leadGAData.total).toNumber()\r\n              : format(adAccount.leadTotal).toNumber()}\r\n          </div>\r\n        </div>\r\n        <div className=\"col-12 col-sm-4 ad-stats__list\">\r\n          <div className=\"ad-stats__key\">平均名單取得成本 CPL</div>\r\n          <div className=\"ad-stats__value\">\r\n            {gaViewIdMap[LEAD] && leadGAData.total\r\n              ? (adAccount.leadSpendTotal / leadGAData.total).toFixed(1)\r\n              : costPerAverageLead}\r\n          </div>\r\n        </div>\r\n        <div className=\"col-12 col-sm-4 ad-stats__list\">\r\n          <div className=\"ad-stats__key\">總花費</div>\r\n          <div className=\"ad-stats__value\">\r\n            {format(\r\n              adAccount.leadSpendTotal + adAccount.preLaunchSpendTotal\r\n            ).toDollar()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const fundingCurrentNumber = Number(\r\n    project.funding_current.replace(/\\$ /g, '').replace(/,/g, '')\r\n  )\r\n  const fundingTargetNumber = Number(\r\n    project.funding_target.replace(/\\$ /g, '').replace(/,/g, '')\r\n  )\r\n  const goalPercentage = Math.floor(\r\n    (fundingCurrentNumber / fundingTargetNumber) * 100\r\n  )\r\n\r\n  const fundRaisingSpendTotalPerFundingCurrent =\r\n    adAccount.fundRaisingSpendTotal / fundingCurrentNumber\r\n\r\n  const countdownInterval = setInterval(function () {\r\n    const t = project.finished_at.split(/[- :]/)\r\n    const countDownDate = new Date(t[0], t[1] - 1, t[2], t[3], t[4]).getTime()\r\n    const now = new Date().getTime()\r\n    const distance = countDownDate - now\r\n\r\n    if (distance <= 0) {\r\n      setCountdown(`已結束`)\r\n      clearInterval(countdownInterval)\r\n    } else {\r\n      const days = Math.floor(distance / (1000 * 60 * 60 * 24))\r\n      const hours = Math.floor(\r\n        (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)\r\n      )\r\n      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))\r\n      const seconds = Math.floor((distance % (1000 * 60)) / 1000)\r\n      setCountdown(`${days} 日 ${hours} 時 ${minutes} 分`)\r\n    }\r\n  }, 1000)\r\n\r\n  return (\r\n    <div className=\"row\">\r\n      <div className=\"col-12 col-sm-6 project__image\">\r\n        <div style={{ backgroundImage: `url(${project.og_image})` }}></div>\r\n      </div>\r\n      <div className=\"col-12 col-sm-6 project__ad-stats row\">\r\n        <div className=\"col-12 ad-stats__list\">\r\n          <div className=\"ad-stats__key\">\r\n            {/* TODO: 串接其他平台 */}\r\n            <a\r\n              href={'https://www.zeczec.com/projects/' + adAccount.projectId}\r\n              target=\"blank\"\r\n            >\r\n              {project.name}\r\n            </a>\r\n          </div>\r\n          <div className=\"ad-stats__value\">{project.funding_current}</div>\r\n        </div>\r\n        <div className=\"col-12 ad-stats__list\">\r\n          <div className=\"ad-stats__key\">上線後廣告花費</div>\r\n          <div className=\"ad-stats__value\">\r\n            {format(adAccount.fundRaisingSpendTotal).toDollar()}\r\n          </div>\r\n        </div>\r\n        <div className=\"col-12 ad-stats__list\">\r\n          <div className=\"ad-stats__key\">上線後廣告占比</div>\r\n          <div className=\"ad-stats__value\">\r\n            {format(fundRaisingSpendTotalPerFundingCurrent).toPercentage()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"col-12 project__content\">\r\n        <div className=\"row project__content-info\">\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">目標</div>\r\n            <div className=\"list__value\">{project.funding_target}</div>\r\n          </div>\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">達成比例</div>\r\n            <div className=\"list__value\">\r\n              {format(goalPercentage).toNumber()}%\r\n            </div>\r\n          </div>\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">贊助人數</div>\r\n            <div className=\"list__value\">{project.sponsor_count}</div>\r\n          </div>\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">時程</div>\r\n            <div className=\"list__value\">\r\n              {project.started_at} ~ {project.finished_at}\r\n            </div>\r\n          </div>\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">倒數</div>\r\n            <div className=\"list__value\">{countdown}</div>\r\n          </div>\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">名單數</div>\r\n            <div className=\"list__value\">\r\n              {gaViewIdMap[LEAD] && leadGAData.total\r\n                ? format(leadGAData.total).toNumber()\r\n                : format(adAccount.leadTotal).toNumber()}\r\n            </div>\r\n          </div>\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">平均 CPL</div>\r\n            <div className=\"list__value\">{costPerAverageLead}</div>\r\n          </div>\r\n          <div className=\"col-12 col-sm-6 project__content-info-list\">\r\n            <div className=\"list__key\">前測/預熱總花費</div>\r\n            <div className=\"list__value\">\r\n              {format(adAccount.leadSpendTotal).toDollar()}\r\n              {' / '}\r\n              {format(adAccount.preLaunchSpendTotal).toDollar()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ProjectContainer\r\n","import React, { useEffect, useState } from 'react'\r\nimport { navigate } from '@reach/router'\r\nimport { connect } from 'react-redux'\r\nimport { bindActionCreators } from 'redux'\r\nimport { format } from '../utils/utils'\r\n\r\nimport './Home.scss'\r\n\r\nimport Switch from '../components/Switch'\r\nimport { HeaderContainer } from '../containers'\r\n\r\nfunction Home({ adAccounts }) {\r\n  const [isFilter, setIsFilter] = useState(true)\r\n\r\n  let filteredAdAccounts = isFilter\r\n    ? [...adAccounts.data].filter((adAccount) => adAccount.adAccountLive)\r\n    : [...adAccounts.data]\r\n  filteredAdAccounts = filteredAdAccounts.sort(\r\n    (a, b) => b.campaignStatus.value - a.campaignStatus.value\r\n  )\r\n  useEffect(() => {\r\n    const params = new URL(document.location).searchParams\r\n    const path = params.get('p')\r\n    if (path) {\r\n      navigate(`${path}`)\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <div className='container position-relative my-3'>\r\n      <HeaderContainer title={'廣告帳戶'} isHome={true} />\r\n      <div className='ad-accounts__switch'>\r\n        <Switch\r\n          labelFor={'isFilter'}\r\n          isOn={isFilter}\r\n          handleToggle={() => setIsFilter(!isFilter)}\r\n          onColor='#e43f5a'\r\n          title='只顯示活躍廣告帳戶'\r\n        />\r\n      </div>\r\n\r\n      {/* 廣告帳戶列表 */}\r\n      {!adAccounts.isLoading ? (\r\n        <>\r\n          <main className='d-flex flex-wrap justify-content-center'>\r\n            {filteredAdAccounts.map(\r\n              ({ name, id, adAccountLive, campaignStatus, amount_spent }) => (\r\n                <div\r\n                  key={id}\r\n                  className='card m-2 ad-account-card'\r\n                  style={{ width: '18rem', opacity: !adAccountLive && 0.3 }}\r\n                >\r\n                  <div\r\n                    className='card-body'\r\n                    onClick={() => navigate(`/ad-account/${id}`)}\r\n                  >\r\n                    <span\r\n                      className={\r\n                        'float-right badge badge-' +\r\n                        (campaignStatus.value === 3\r\n                          ? 'launch'\r\n                          : campaignStatus.value === 2\r\n                          ? 'pre-launch'\r\n                          : campaignStatus.value === 1\r\n                          ? 'lead'\r\n                          : '')\r\n                      }\r\n                    >\r\n                      {campaignStatus.name}\r\n                    </span>\r\n\r\n                    <h5 className='card-title'>{name}</h5>\r\n                    <p className='card-text'>\r\n                      {/* 總廣告花費：{format(amount_spent).toDollar()} */}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              )\r\n            )}\r\n          </main>\r\n        </>\r\n      ) : (\r\n        <div className='text-center my-5'>\r\n          <div className='spinner-border text-primary' role='status'>\r\n            <span className='sr-only'>Loading...</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nconst mapStateToProps = ({ adAccounts }) => ({\r\n  adAccounts,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch) => bindActionCreators({}, dispatch)\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Home)\r\n","import React, { useEffect, useState } from 'react'\r\n\r\nconst useGoogleAnalytics = (reportRequests, fetchCount) => {\r\n  const [data, setData] = useState({})\r\n  const gaRequestData = {\r\n    path: '/v4/reports:batchGet',\r\n    root: 'https://analyticsreporting.googleapis.com/',\r\n    method: 'POST',\r\n    body: {\r\n      reportRequests,\r\n    },\r\n  }\r\n\r\n  let tokenClient\r\n\r\n  async function getToken(err) {\r\n    if (\r\n      err.result.error.code === 401 ||\r\n      (err.result.error.code === 403 &&\r\n        err.result.error.status === 'PERMISSION_DENIED')\r\n    ) {\r\n      // The access token is missing, invalid, or expired, prompt for user consent to obtain one.\r\n      await new Promise((resolve, reject) => {\r\n        try {\r\n          // Settle this promise in the response callback for requestAccessToken()\r\n          tokenClient.callback = (resp) => {\r\n            if (resp.error !== undefined) {\r\n              reject(resp)\r\n            }\r\n            // GIS has automatically updated gapi.client with the newly issued access token.\r\n            // console.log(\r\n            //   'gapi.client access token: ' +\r\n            //     JSON.stringify(window.gapi.client.getToken())\r\n            // )\r\n            resolve(resp)\r\n          }\r\n\r\n          tokenClient.requestAccessToken()\r\n        } catch (err) {\r\n          console.log(err)\r\n        }\r\n      })\r\n    } else {\r\n      // Errors unrelated to authorization: server errors, exceeding quota, bad requests, and so on.\r\n      throw new Error(err)\r\n    }\r\n  }\r\n\r\n  function queryReports() {\r\n    window.gapi.client\r\n      .request(gaRequestData)\r\n      .then((res) => {\r\n        setData(generateDateToGoal(res))\r\n      })\r\n      .catch((err) => getToken(err)) // for authorization errors obtain an access token\r\n      .then((retry) => window.gapi.client.request(gaRequestData))\r\n      .then((res) => {\r\n        setData(generateDateToGoal(res))\r\n      })\r\n      .catch((err) => console.log(err)) // cancelled by user, timeout, etc.\r\n  }\r\n\r\n  function generateDateToGoal(res) {\r\n    // console.log('res', res)\r\n\r\n    const { rows, totals } = res.result.reports[0].data\r\n    // console.log('totals', totals)\r\n    // console.log('rows', rows)\r\n\r\n    const dateToGoalMap = {}\r\n\r\n    if (!rows || rows.length === 0) {\r\n      return dateToGoalMap\r\n    }\r\n\r\n    dateToGoalMap['total'] = Number(totals[0].values[0])\r\n    rows.forEach(({ dimensions, metrics }) => {\r\n      let date = dimensions[0]\r\n      date = `${date.slice(0, 4)}-${date.slice(4, 6)}-${date.slice(6, 8)}`\r\n      const value = metrics[0].values[0]\r\n      dateToGoalMap[date] = Number(value)\r\n    })\r\n\r\n    // console.log('dateToGoalMap', dateToGoalMap)\r\n    return dateToGoalMap\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (fetchCount === 0) {\r\n      return\r\n    }\r\n    let gapiLoadOkay\r\n    let gapiLoadFail\r\n    let gisLoadOkay\r\n    let gisLoadFail\r\n\r\n    // 處理載入完才顯示的問題\r\n\r\n    const gapiLoadPromise = new Promise((resolve, reject) => {\r\n      gapiLoadOkay = resolve\r\n      gapiLoadFail = reject\r\n    })\r\n    const gisLoadPromise = new Promise((resolve, reject) => {\r\n      gisLoadOkay = resolve\r\n      gisLoadFail = reject\r\n    })\r\n\r\n    ;(async () => {\r\n      // First, load and initialize the gapi.client\r\n      await gapiLoadPromise\r\n      await new Promise((resolve, reject) => {\r\n        // NOTE: the 'auth2' module is no longer loaded.\r\n        window.gapi.load('client', { callback: resolve, onerror: reject })\r\n      })\r\n      await window.gapi.client.init({\r\n        // NOTE: OAuth2 'scope' and 'client_id' parameters have moved to initTokenClient().\r\n      })\r\n\r\n      // Now load the GIS client\r\n      await gisLoadPromise\r\n      await new Promise((resolve, reject) => {\r\n        try {\r\n          tokenClient = window.google.accounts.oauth2.initTokenClient({\r\n            client_id:\r\n              '577256234296-krnknsj2vflrk1vagg05aorhsj9pugh3.apps.googleusercontent.com',\r\n            scope: 'https://www.googleapis.com/auth/analytics.readonly',\r\n            prompt: 'consent',\r\n            callback: '', // defined at request time in await/promise scope.\r\n          })\r\n          resolve()\r\n        } catch (err) {\r\n          reject(err)\r\n        }\r\n      })\r\n\r\n      queryReports()\r\n    })()\r\n\r\n    const gapiScript = document.createElement('script')\r\n    gapiScript.src = 'https://apis.google.com/js/api.js'\r\n    gapiScript.async = true\r\n    gapiScript.defer = true\r\n    gapiScript.onload = gapiLoadOkay\r\n    gapiScript.onerror = gapiLoadFail\r\n\r\n    const gisScript = document.createElement('script')\r\n    gisScript.src = 'https://accounts.google.com/gsi/client'\r\n    gisScript.async = true\r\n    gisScript.defer = true\r\n    gisScript.onload = gisLoadOkay\r\n    gisScript.onerror = gisLoadFail\r\n\r\n    document.body.appendChild(gapiScript)\r\n    document.body.appendChild(gisScript)\r\n\r\n    // return () => {\r\n    //     document.body.removeChild(script);\r\n    // };\r\n  }, [fetchCount])\r\n\r\n  return data\r\n}\r\n\r\nexport default useGoogleAnalytics\r\n","import React, { useEffect, useState, useCallback } from 'react'\r\nimport { useImmer } from 'use-immer'\r\nimport { Line } from 'react-chartjs-2'\r\nimport ChartDataLabels from 'chartjs-plugin-datalabels'\r\nimport { format, debounce, textareaAutoResize } from '../utils/utils'\r\nimport { connect } from 'react-redux'\r\nimport { bindActionCreators } from 'redux'\r\n\r\nimport { HeaderContainer, ProjectContainer } from '../containers'\r\nimport { useGoogleAnalytics } from '../hooks'\r\n\r\nimport './AdAccount.scss'\r\n\r\nfunction AdAccount({ adAccountId, user }) {\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  const LEAD = 'lead'\r\n  const FUND_RAISING = 'fundRaising'\r\n  const BREW = 'brew'\r\n  const [tabTopic, setTabTopic] = useState(LEAD)\r\n\r\n  const timeZoneOffset = new Date().getTimezoneOffset() * 60 * 1000\r\n  const initialTimeRange90Days = 90 * 24 * 60 * 60 * 1000\r\n  const initialSinceTime =\r\n    new Date().getTime() - timeZoneOffset - initialTimeRange90Days\r\n  const initialUntilTime = new Date().getTime() - timeZoneOffset\r\n  const initialSinceDate = new Date(initialSinceTime)\r\n    .toISOString()\r\n    .split('T')[0]\r\n  const initialUntilDate = new Date(initialUntilTime)\r\n    .toISOString()\r\n    .split('T')[0]\r\n  const [timeRangeSince, setTimeRangeSince] = useState(initialSinceDate)\r\n  const [timeRangeUntil, setTimeRangeUntil] = useState(initialUntilDate)\r\n  const [numberOfReload, setNumberOfReload] = useState(1)\r\n\r\n  const [adAccount, setAdAccount] = useImmer({\r\n    name: '',\r\n    platformId: '',\r\n    projectId: '',\r\n    data: [],\r\n    dateArray: [],\r\n\r\n    leadSpendTotal: 0,\r\n    leadSpendDaily: [],\r\n    leadTotal: 0,\r\n    leadDaily: [],\r\n    costPerLeadDaily: [],\r\n\r\n    preLaunchSpendTotal: 0,\r\n    preLaunchSpendDaily: [],\r\n\r\n    fundRaisingSpendTotal: 0,\r\n    fundRaisingSpendDaily: [],\r\n    adsDirectFundRaisingTotal: 0,\r\n    adsDirectFundRaisingDaily: [],\r\n    adsDirectRoasDaily: [],\r\n\r\n    fundRaisingTotal: 0,\r\n    fundRaisingDaily: [],\r\n    orderCountTotal: 0,\r\n    orderCountDaily: [],\r\n    totalRoasDaily: [],\r\n\r\n    brewData: {\r\n      adsDirectRoasDaily: [],\r\n    },\r\n  })\r\n  // console.log(adAccount.dateArray)\r\n  const [project, setProject] = useImmer({\r\n    started_at: undefined,\r\n    fundRaisingDateMap: undefined,\r\n    orderCountDateMap: undefined,\r\n  })\r\n  const [comment, setComment] = useImmer({})\r\n  const updateCommentCallback = useCallback(\r\n    debounce((value, date) => {\r\n      updateComment(value, date)\r\n    }, 600),\r\n    []\r\n  )\r\n\r\n  const [chatbot, setChatbot] = useImmer(false)\r\n  const [brew, setBrew] = useImmer({\r\n    isOpen: false,\r\n    totalOrderCount: 0,\r\n    totalOrderSum: 0,\r\n    orderStatsDaily: [],\r\n    dateArray: [],\r\n    dateToOrderSum: {},\r\n  })\r\n\r\n  const chartGlobalOptions = {\r\n    maintainAspectRatio: false,\r\n    elements: {\r\n      line: {\r\n        tension: 0,\r\n        borderWidth: 2,\r\n      },\r\n      point: {\r\n        radius: 0,\r\n      },\r\n    },\r\n    hover: {\r\n      intersect: false,\r\n    },\r\n    tooltips: {\r\n      mode: 'index',\r\n      intersect: false,\r\n    },\r\n  }\r\n\r\n  const fundRaisingLineChartData = {\r\n    labels:\r\n      project.projectStartIndex !== undefined\r\n        ? project.projectStartIndex === -1\r\n          ? [...adAccount.dateArray].reverse()\r\n          : [...adAccount.dateArray].reverse().slice(project.projectStartIndex)\r\n        : [],\r\n    datasets: [\r\n      {\r\n        label: '總體 ROAS',\r\n        fill: false,\r\n        borderColor: '#1060AB',\r\n        pointBackgroundColor: '#1060AB',\r\n        pointHoverBackgroundColor: '#1060AB',\r\n        datalabels: {\r\n          color: '#1060AB',\r\n          align: 'top',\r\n          offset: 8,\r\n        },\r\n        data:\r\n          project.projectStartIndex !== undefined\r\n            ? project.projectStartIndex === -1\r\n              ? [...adAccount.totalRoasDaily].reverse()\r\n              : [...adAccount.totalRoasDaily]\r\n                  .reverse()\r\n                  .slice(project.projectStartIndex)\r\n            : [],\r\n      },\r\n      {\r\n        label: '廣告 ROAS',\r\n        fill: false,\r\n        borderColor: '#1FA3EE',\r\n        pointBackgroundColor: '#1FA3EE',\r\n        pointHoverBackgroundColor: '#1FA3EE',\r\n        datalabels: {\r\n          color: '#1FA3EE',\r\n          align: 'bottom',\r\n          offset: 8,\r\n        },\r\n        data:\r\n          project.projectStartIndex !== undefined\r\n            ? project.projectStartIndex === -1\r\n              ? [...adAccount.adsDirectRoasDaily].reverse()\r\n              : [...adAccount.adsDirectRoasDaily]\r\n                  .reverse()\r\n                  .slice(project.projectStartIndex)\r\n            : [],\r\n      },\r\n    ],\r\n  }\r\n  const fundRaisingLineChartOptions = {\r\n    ...chartGlobalOptions,\r\n    scales: {\r\n      yAxes: [\r\n        {\r\n          type: 'linear',\r\n          display: true,\r\n          position: 'left',\r\n          scaleLabel: {\r\n            display: true,\r\n            labelString: 'ROAS',\r\n          },\r\n        },\r\n      ],\r\n      xAxes: [\r\n        {\r\n          ticks: {\r\n            callback: function (value, index, values) {\r\n              return value.slice(5)\r\n            },\r\n          },\r\n        },\r\n      ],\r\n    },\r\n  }\r\n\r\n  const leadLineChartData = {\r\n    labels: project.projectStartIndex\r\n      ? [...adAccount.dateArray]\r\n          .reverse()\r\n          .slice(0, project.projectStartIndex + 1)\r\n      : [...adAccount.dateArray].reverse(),\r\n    datasets: [\r\n      {\r\n        label: 'CPL(FB)',\r\n        fill: false,\r\n        borderColor: '#D07D00',\r\n        pointBackgroundColor: '#D07D00',\r\n        pointHoverBackgroundColor: '#D07D00',\r\n        datalabels: {\r\n          color: '#D07D00',\r\n          align: 'top',\r\n          offset: 8,\r\n        },\r\n        data: project.projectStartIndex\r\n          ? [...adAccount.costPerLeadDaily]\r\n              .reverse()\r\n              .slice(0, project.projectStartIndex + 1)\r\n          : [...adAccount.costPerLeadDaily].reverse(),\r\n      },\r\n    ],\r\n  }\r\n\r\n  const leadLineChartOptions = {\r\n    ...chartGlobalOptions,\r\n    scales: {\r\n      yAxes: [\r\n        {\r\n          type: 'linear',\r\n          display: true,\r\n          position: 'left',\r\n          scaleLabel: {\r\n            fontColor: '#D07D00',\r\n            display: true,\r\n            labelString: '名單取得成本',\r\n          },\r\n        },\r\n      ],\r\n      xAxes: [\r\n        {\r\n          ticks: {\r\n            callback: function (value, index, values) {\r\n              return value.slice(5)\r\n            },\r\n          },\r\n        },\r\n      ],\r\n    },\r\n  }\r\n\r\n  const brewLineChartData = {\r\n    labels: [...brew.dateArray],\r\n    datasets: [],\r\n  }\r\n\r\n  if (brew.isOpen && adAccount.brewData.brewAdsSpendTotal) {\r\n    const brewTotalRoasDaily = []\r\n    const brewAdsDirectRoasDaily = []\r\n    brew.dateArray.forEach((date) => {\r\n      if (adAccount.brewData[date]?.spend === 0) {\r\n        brewTotalRoasDaily.push(null)\r\n        brewAdsDirectRoasDaily.push(null)\r\n        return\r\n      }\r\n      brewTotalRoasDaily.push(\r\n        (brew.dateToOrderSum[date] / adAccount.brewData[date]?.spend).toFixed(1)\r\n      )\r\n      brewAdsDirectRoasDaily.push(\r\n        (\r\n          adAccount.brewData[date]?.revenue / adAccount.brewData[date]?.spend\r\n        ).toFixed(1)\r\n      )\r\n    })\r\n    brewLineChartData.datasets.push(\r\n      {\r\n        label: '總體 ROAS',\r\n        fill: false,\r\n        borderColor: '#21912a',\r\n        pointBackgroundColor: '#21912a',\r\n        pointHoverBackgroundColor: '#21912a',\r\n        datalabels: {\r\n          color: '#21912a',\r\n          align: 'top',\r\n          offset: 8,\r\n        },\r\n        data: brewTotalRoasDaily,\r\n      },\r\n      {\r\n        label: '廣告 ROAS',\r\n        fill: false,\r\n        borderColor: '#48bf53',\r\n        pointBackgroundColor: '#48bf53',\r\n        pointHoverBackgroundColor: '#48bf53',\r\n        datalabels: {\r\n          color: '#48bf53',\r\n          align: 'bottom',\r\n          offset: 8,\r\n        },\r\n        data: brewAdsDirectRoasDaily,\r\n      }\r\n    )\r\n  }\r\n\r\n  const brewLineChartOptions = {\r\n    ...chartGlobalOptions,\r\n    scales: {\r\n      yAxes: [\r\n        {\r\n          type: 'linear',\r\n          display: true,\r\n          position: 'left',\r\n          scaleLabel: {\r\n            fontColor: '#48bf53',\r\n            display: true,\r\n            labelString: 'ROAS',\r\n          },\r\n        },\r\n      ],\r\n      xAxes: [\r\n        {\r\n          ticks: {\r\n            callback: function (value, index, values) {\r\n              return value.slice(5)\r\n            },\r\n          },\r\n        },\r\n      ],\r\n    },\r\n  }\r\n\r\n  const initialGaViewIdMap = {}\r\n  initialGaViewIdMap[LEAD] = ''\r\n  initialGaViewIdMap[FUND_RAISING] = ''\r\n  const [gaViewIdMap, setGaViewIdMap] = useImmer(initialGaViewIdMap)\r\n  // console.log('gaViewIdMap', gaViewIdMap)\r\n\r\n  const leadGAReportRequests = [\r\n    {\r\n      viewId: gaViewIdMap[LEAD],\r\n      dateRanges: [\r\n        {\r\n          startDate: timeRangeSince,\r\n          endDate: timeRangeUntil,\r\n        },\r\n      ],\r\n      metrics: [\r\n        {\r\n          expression: 'ga:goalCompletionsAll',\r\n        },\r\n      ],\r\n      dimensions: [{ name: 'ga:date' }],\r\n    },\r\n  ]\r\n  const [fetchLeadGACount, setFetchLeadGACount] = useState(0)\r\n  const leadGAData = useGoogleAnalytics(leadGAReportRequests, fetchLeadGACount)\r\n  // console.log('leadGAData', leadGAData)\r\n\r\n  if (\r\n    gaViewIdMap[LEAD] &&\r\n    leadGAData.total &&\r\n    adAccount.leadSpendDaily.length\r\n  ) {\r\n    let costPerGALeadDaily = []\r\n    adAccount.dateArray.map((date, index) => {\r\n      if (leadGAData[date]) {\r\n        costPerGALeadDaily.push(\r\n          (adAccount.leadSpendDaily[index] / leadGAData[date]).toFixed(1)\r\n        )\r\n      } else {\r\n        costPerGALeadDaily.push(null)\r\n      }\r\n    })\r\n\r\n    leadLineChartData.datasets.push({\r\n      label: 'CPL(GA)',\r\n      fill: false,\r\n      borderColor: '#f9af0b',\r\n      pointBackgroundColor: '#f9af0b',\r\n      pointHoverBackgroundColor: '#f9af0b',\r\n      datalabels: {\r\n        color: '#f9af0b',\r\n        align: 'top',\r\n        offset: 8,\r\n      },\r\n      data: project.projectStartIndex\r\n        ? [...costPerGALeadDaily]\r\n            .reverse()\r\n            .slice(0, project.projectStartIndex + 1)\r\n        : [...costPerGALeadDaily].reverse(),\r\n    })\r\n  }\r\n\r\n  const fundRaisingGAReportRequests = [\r\n    {\r\n      viewId: gaViewIdMap[FUND_RAISING],\r\n      dateRanges: [\r\n        {\r\n          startDate: timeRangeSince,\r\n          endDate: timeRangeUntil,\r\n        },\r\n      ],\r\n      metrics: [\r\n        {\r\n          expression: 'ga:transactionRevenue',\r\n        },\r\n      ],\r\n      dimensions: [{ name: 'ga:date' }],\r\n    },\r\n  ]\r\n  const [fetchFundRaisingGACount, setFetchFundRaisingGACount] = useState(0)\r\n  const fundRaisingGAData = useGoogleAnalytics(\r\n    fundRaisingGAReportRequests,\r\n    fetchFundRaisingGACount\r\n  )\r\n  // console.log('fundRaisingGAData', fundRaisingGAData)\r\n\r\n  // 取得廣告帳號資料、廣告數據資料\r\n  useEffect(() => {\r\n    if (timeRangeSince >= timeRangeUntil) {\r\n      alert('開始時間必須小於結束時間')\r\n      return\r\n    }\r\n    fetchAdAccountInfo()\r\n    fetchAdAccountInsights()\r\n    fetchChatbotData()\r\n    fetchBrewData()\r\n\r\n    function fetchAdAccountInfo() {\r\n      fetch(\r\n        // `http://localhost:8000/ad-account/info/${adAccountId}`\r\n        `https://syphon-api.crowdfunding.coffee/ad-account/info/${adAccountId}`\r\n      )\r\n        .then((res) => res.json())\r\n        .then((res) => {\r\n          setAdAccount((state) => {\r\n            state.name = res.name\r\n            state.platformId = res.business_street\r\n            state.projectId = res.business_street2\r\n          })\r\n        })\r\n    }\r\n\r\n    function fetchAdAccountInsights() {\r\n      setLoading(true)\r\n      fetch(\r\n        // `http://localhost:8000/ad-account/insights/${adAccountId}?timeRangeSince=${timeRangeSince}&timeRangeUntil=${timeRangeUntil}`\r\n        `https://syphon-api.crowdfunding.coffee/ad-account/insights/${adAccountId}?timeRangeSince=${timeRangeSince}&timeRangeUntil=${timeRangeUntil}`\r\n      )\r\n        .then((res) => res.json())\r\n        .then((res) => {\r\n          console.log(res)\r\n          if (res.data) {\r\n            setAdAccount((state) => {\r\n              state.data = formatDataMart(res.data)\r\n            })\r\n          } else {\r\n            setAdAccount((state) => {\r\n              state.data = {}\r\n            })\r\n          }\r\n\r\n          setLoading(false)\r\n        })\r\n    }\r\n\r\n    function formatDataMart(rawData) {\r\n      const dataMart = {}\r\n      rawData.forEach((data) => {\r\n        const date = data.date_start\r\n        const campaignType = getCampaignType(data)\r\n\r\n        dataMart[date]\r\n          ? dataMart[date][campaignType]\r\n            ? dataMart[date][campaignType].push(data)\r\n            : (dataMart[date][campaignType] = [data])\r\n          : (dataMart[date] = { [campaignType]: [data] })\r\n\r\n        dataMart[date].date = date\r\n      })\r\n      console.log('dataMart:', dataMart)\r\n      return dataMart\r\n    }\r\n\r\n    function getCampaignType(data) {\r\n      return data.campaign_name.includes('預熱')\r\n        ? '預熱'\r\n        : data.campaign_name.includes('前測')\r\n        ? '前測'\r\n        : data.campaign_name.includes('上線')\r\n        ? '上線'\r\n        : data.campaign_name.toLowerCase().includes('brew')\r\n        ? 'BREW'\r\n        : 'none'\r\n    }\r\n\r\n    function fetchChatbotData() {\r\n      fetch(\r\n        `https://beans-logistics.crowdfunding.coffee/openapi/syphon.php?act=${adAccountId.slice(\r\n          4\r\n        )}&start=${timeRangeSince}&end=${timeRangeUntil}`\r\n      )\r\n        .then((res) => res.json())\r\n        .then((res) => {\r\n          if (res.length > 0) {\r\n            const chatbotMap = {}\r\n            let chatbotTotal = 0\r\n            res.forEach(({ date_time, order_audience }) => {\r\n              chatbotTotal += order_audience\r\n              chatbotMap[format(date_time).toDate()] = order_audience\r\n            })\r\n            // console.log(chatbotMap)\r\n            setChatbot((state) => chatbotMap)\r\n            setAdAccount((state) => {\r\n              state.chatbotTotal = chatbotTotal\r\n            })\r\n          } else {\r\n            setChatbot((state) => false)\r\n            setAdAccount((state) => {\r\n              state.chatbotTotal = 0\r\n            })\r\n          }\r\n        })\r\n        .catch((res) => {\r\n          console.error(res)\r\n          setChatbot((state) => false)\r\n          setAdAccount((state) => {\r\n            state.chatbotTotal = 0\r\n          })\r\n        })\r\n    }\r\n\r\n    function fetchBrewData() {\r\n      fetch(\r\n        `https://brew-logistics.crowdfunding.coffee/openapi/syphon_preorder.php?act=${adAccountId.slice(\r\n          4\r\n        )}&start=${timeRangeSince}&end=${timeRangeUntil}`\r\n      )\r\n        .then((res) => res.json())\r\n        .then((res) => {\r\n          if (res.length > 0) {\r\n            const isOpen = true\r\n            let orderStatsDaily = []\r\n            let totalOrderCount = 0\r\n            let totalOrderSum = 0\r\n            let dateArray = []\r\n            let dateToOrderSum = {}\r\n\r\n            res.forEach(({ date_time, order_sum, order_count }) => {\r\n              totalOrderSum += order_sum\r\n              totalOrderCount += order_count\r\n              orderStatsDaily.push({\r\n                date: format(date_time).toDate(),\r\n                orderSum: order_sum,\r\n                orderCount: order_count,\r\n              })\r\n\r\n              dateArray.push(format(date_time).toDate())\r\n              dateToOrderSum[format(date_time).toDate()] = order_sum\r\n            })\r\n            orderStatsDaily = orderStatsDaily.reverse()\r\n\r\n            setBrew((state) => ({\r\n              isOpen,\r\n              orderStatsDaily,\r\n              totalOrderCount,\r\n              totalOrderSum,\r\n              dateArray,\r\n              dateToOrderSum,\r\n            }))\r\n          }\r\n        })\r\n        .catch((res) => {\r\n          console.error(res)\r\n          setBrew((state) => {\r\n            state.isOpen = false\r\n          })\r\n        })\r\n    }\r\n  }, [adAccountId, setAdAccount, numberOfReload])\r\n\r\n  // 處理廣告數據資料\r\n  useEffect(() => {\r\n    generateChartData()\r\n\r\n    function generateChartData() {\r\n      let dateArray = Object.keys(adAccount.data)\r\n\r\n      let leadSpendTotal = 0\r\n      let leadSpendDaily = []\r\n      let leadTotal = 0\r\n      let leadDaily = []\r\n      let costPerLeadDaily = []\r\n\r\n      let preLaunchSpendTotal = 0\r\n      let preLaunchSpendDaily = []\r\n\r\n      let fundRaisingSpendTotal = 0\r\n      let fundRaisingSpendDaily = []\r\n      let adsDirectFundRaisingTotal = 0\r\n      let adsDirectFundRaisingDaily = []\r\n      let adsDirectRoasDaily = []\r\n\r\n      let brewData = {\r\n        brewAdsSpendTotal: 0,\r\n        brewAdsRevenueTotal: 0,\r\n      }\r\n\r\n      Object.values(adAccount.data).forEach((dateData) => {\r\n        if (dateData['預熱']) {\r\n          const adCampaignArray = dateData['預熱']\r\n          let totalSpend = 0\r\n\r\n          adCampaignArray.forEach((adCampaign) => {\r\n            if (parseInt(adCampaign.spend) === 0) {\r\n              return\r\n            }\r\n\r\n            const adCampaignSpend = parseInt(adCampaign.spend)\r\n\r\n            totalSpend += adCampaignSpend\r\n          })\r\n          if (totalSpend !== 0) {\r\n            preLaunchSpendTotal += totalSpend\r\n            preLaunchSpendDaily.push(totalSpend)\r\n          } else {\r\n            preLaunchSpendDaily.push(null)\r\n          }\r\n        } else {\r\n          preLaunchSpendDaily.push(null)\r\n        }\r\n\r\n        if (dateData['前測']) {\r\n          const adCampaignArray = dateData['前測']\r\n          let totalSpend = 0\r\n          let totalLead = 0\r\n\r\n          adCampaignArray.forEach((adCampaign) => {\r\n            if (parseInt(adCampaign.spend) === 0 || !adCampaign.actions) {\r\n              return\r\n            }\r\n\r\n            const adCampaignSpend = parseInt(adCampaign.spend)\r\n            const adCampaignLeadAction = adCampaign.actions.find((action) => {\r\n              if (\r\n                adCampaign.campaign_name.toLowerCase().includes('surveycake')\r\n              ) {\r\n                return action.action_type.startsWith(\r\n                  'offsite_conversion.custom.'\r\n                )\r\n              } else {\r\n                return (\r\n                  action.action_type === 'offsite_conversion.fb_pixel_custom' ||\r\n                  (action.action_type === 'lead') |\r\n                    (action.action_type ===\r\n                      'offsite_conversion.fb_pixel_complete_registration')\r\n                )\r\n              }\r\n            })\r\n\r\n            totalSpend += adCampaignSpend\r\n            totalLead += adCampaignLeadAction\r\n              ? parseInt(adCampaignLeadAction.value)\r\n              : 0\r\n          })\r\n          if (totalSpend !== 0 && totalLead !== 0) {\r\n            leadSpendTotal += totalSpend\r\n            leadSpendDaily.push(totalSpend)\r\n\r\n            leadTotal += totalLead\r\n            leadDaily.push(totalLead)\r\n            costPerLeadDaily.push((totalSpend / totalLead).toFixed(1))\r\n          } else {\r\n            leadSpendDaily.push(null)\r\n            leadDaily.push(null)\r\n            costPerLeadDaily.push(null)\r\n          }\r\n        } else {\r\n          leadSpendDaily.push(null)\r\n          leadDaily.push(null)\r\n          costPerLeadDaily.push(null)\r\n        }\r\n\r\n        if (dateData['上線']) {\r\n          const adCampaignArray = dateData['上線']\r\n          let totalSpend = 0\r\n          let totalRevenue = 0\r\n\r\n          adCampaignArray.forEach((adCampaign) => {\r\n            if (parseInt(adCampaign.spend) === 0) {\r\n              return\r\n            }\r\n\r\n            const adCampaignSpend = parseInt(adCampaign.spend)\r\n            const adCampaignOmniPurchaseAction =\r\n              adCampaign.action_values &&\r\n              adCampaign.action_values.find(\r\n                (action) => action.action_type === 'omni_purchase'\r\n              )\r\n            totalSpend += adCampaignSpend\r\n            totalRevenue += adCampaignOmniPurchaseAction\r\n              ? parseInt(adCampaignOmniPurchaseAction.value)\r\n              : 0\r\n          })\r\n\r\n          if (totalSpend !== 0) {\r\n            fundRaisingSpendTotal += totalSpend\r\n            fundRaisingSpendDaily.push(totalSpend)\r\n            adsDirectFundRaisingTotal += totalRevenue\r\n            adsDirectFundRaisingDaily.push(totalRevenue)\r\n            adsDirectRoasDaily.push((totalRevenue / totalSpend).toFixed(1))\r\n          } else {\r\n            fundRaisingSpendDaily.push(null)\r\n            adsDirectFundRaisingDaily.push(null)\r\n            adsDirectRoasDaily.push(null)\r\n          }\r\n        } else {\r\n          fundRaisingSpendDaily.push(null)\r\n          adsDirectFundRaisingDaily.push(null)\r\n          adsDirectRoasDaily.push(null)\r\n        }\r\n\r\n        if (dateData['BREW']) {\r\n          const adCampaignArray = dateData['BREW']\r\n          let totalSpend = 0\r\n          let totalRevenue = 0\r\n\r\n          adCampaignArray.forEach((adCampaign) => {\r\n            if (parseInt(adCampaign.spend) === 0) {\r\n              return\r\n            }\r\n\r\n            const adCampaignSpend = parseInt(adCampaign.spend)\r\n            const adCampaignOmniPurchaseAction =\r\n              adCampaign.action_values &&\r\n              adCampaign.action_values.find(\r\n                (action) => action.action_type === 'omni_purchase'\r\n              )\r\n            totalSpend += adCampaignSpend\r\n            totalRevenue += adCampaignOmniPurchaseAction\r\n              ? parseInt(adCampaignOmniPurchaseAction.value)\r\n              : 0\r\n          })\r\n\r\n          brewData[dateData.date] = {\r\n            spend: totalSpend,\r\n            revenue: totalRevenue,\r\n          }\r\n          brewData.brewAdsSpendTotal += totalSpend\r\n          brewData.brewAdsRevenueTotal += totalRevenue\r\n        }\r\n      })\r\n\r\n      // console.log(adAccount.data, leadSpendDaily, costPerLeadDaily)\r\n      // console.log('brewData', brewData)\r\n\r\n      setAdAccount((state) => {\r\n        state.dateArray = dateArray\r\n\r\n        state.leadSpendTotal = leadSpendTotal\r\n        state.leadSpendDaily = leadSpendDaily\r\n        state.leadTotal = leadTotal\r\n        state.leadDaily = leadDaily\r\n        state.costPerLeadDaily = costPerLeadDaily\r\n\r\n        state.preLaunchSpendTotal = preLaunchSpendTotal\r\n        state.preLaunchSpendDaily = preLaunchSpendDaily\r\n\r\n        state.fundRaisingSpendTotal = fundRaisingSpendTotal\r\n        state.fundRaisingSpendDaily = fundRaisingSpendDaily\r\n        state.adsDirectFundRaisingTotal = adsDirectFundRaisingTotal\r\n        state.adsDirectFundRaisingDaily = adsDirectFundRaisingDaily\r\n        state.adsDirectRoasDaily = adsDirectRoasDaily\r\n\r\n        state.brewData = brewData\r\n      })\r\n    }\r\n  }, [adAccount.data, setAdAccount])\r\n\r\n  // 取得嘖嘖集資資料\r\n  useEffect(() => {\r\n    const platformId = adAccount.platformId\r\n    const projectId = adAccount.projectId\r\n    if (platformId && projectId) {\r\n      fetchFundingData(platformId, projectId)\r\n    }\r\n\r\n    function fetchFundingData(platformId, projectId) {\r\n      fetch(\r\n        `https://drip-plugin.crowdfunding.coffee/api/platform/${platformId}/projects/${projectId}`\r\n      )\r\n        .then((res) => res.json())\r\n        .then((res) => {\r\n          setProject((state) => {\r\n            let timeline = JSON.parse(res.timeline)\r\n\r\n            if (res.customize_timeline) {\r\n              const customize_timeline = JSON.parse(res.customize_timeline)\r\n              timeline.push(...customize_timeline)\r\n            }\r\n\r\n            return {\r\n              ...state,\r\n              ...res,\r\n              timeline: timeline.sort((a, b) => a[0] - b[0]),\r\n              sponsor_count: format(res.sponsor_count).toNumber(),\r\n              funding_target: format(res.funding_target).toDollar(),\r\n              funding_current: format(res.funding_current).toDollar(),\r\n              started_at: format(res.started_at).toProjectTime(),\r\n              finished_at: format(res.finished_at).toProjectTime(),\r\n            }\r\n          })\r\n        })\r\n    }\r\n  }, [adAccount.platformId, adAccount.projectId, setProject])\r\n\r\n  // 處理嘖嘖集資資料\r\n  useEffect(() => {\r\n    if (!project.timeline) return\r\n\r\n    const projectStartDate = project.started_at.slice(0, 10)\r\n    const projectStartIndex = [...adAccount.dateArray]\r\n      .reverse()\r\n      .findIndex((e) => e === projectStartDate)\r\n    // Add datetime.slice(0,-1) to cut the denoted by the suffix \"Z\"\r\n    let projectStartAt =\r\n      new Date(project.started_at.slice(0, -1)).getTime() / 1000\r\n    let projectFinishAt =\r\n      new Date(project.finished_at.slice(0, -1)).getTime() / 1000\r\n    // Minus one hour to get the zero data.\r\n    projectStartAt = projectStartAt - 60 * 60\r\n\r\n    const timelineDataMart = {}\r\n    project.timeline.forEach((data) => {\r\n      if (data[0] < projectStartAt || data[0] > projectFinishAt) return\r\n\r\n      const date = format(data[0] * 1000).toDate()\r\n      const time = format(data[0] * 1000).toTime()\r\n      const fundingData = [time, data[1], data[2]]\r\n\r\n      timelineDataMart[date]\r\n        ? timelineDataMart[date].push(fundingData)\r\n        : (timelineDataMart[date] = [fundingData])\r\n    })\r\n\r\n    const fundRaisingDateMap = {}\r\n    const orderCountDateMap = {}\r\n    let fundingOfThePreviousDay = 0\r\n    let orderOfThePreviousDay = 0\r\n    for (let [date, fundingData] of Object.entries(timelineDataMart)) {\r\n      const fundingToday = fundingData[fundingData.length - 1][2]\r\n      const orderToday = fundingData[fundingData.length - 1][1]\r\n      fundRaisingDateMap[date] = fundingToday - fundingOfThePreviousDay\r\n      orderCountDateMap[date] = orderToday - orderOfThePreviousDay\r\n      fundingOfThePreviousDay = fundingToday\r\n      orderOfThePreviousDay = orderToday\r\n    }\r\n    // console.log(fundRaisingDateMap, orderCountDateMap)\r\n\r\n    setProject((state) => {\r\n      state.fundRaisingDateMap = fundRaisingDateMap\r\n      state.orderCountDateMap = orderCountDateMap\r\n      state.projectStartIndex = projectStartIndex\r\n    })\r\n  }, [\r\n    project.timeline,\r\n    project.started_at,\r\n    project.finished_at,\r\n    setProject,\r\n    adAccount.dateArray,\r\n  ])\r\n\r\n  // 嘖嘖集資資料 => 廣數數據資料\r\n  useEffect(() => {\r\n    if (\r\n      project.fundRaisingDateMap &&\r\n      adAccount.fundRaisingSpendDaily.length > 0\r\n    ) {\r\n      let fundRaisingTotal = 0\r\n      const fundRaisingDaily = []\r\n      let orderCountTotal = 0\r\n      const orderCountDaily = []\r\n\r\n      const totalRoasDaily = []\r\n      adAccount.dateArray.forEach((date, index) => {\r\n        fundRaisingTotal += project.fundRaisingDateMap[date]\r\n          ? project.fundRaisingDateMap[date]\r\n          : 0\r\n        fundRaisingDaily.push(project.fundRaisingDateMap[date])\r\n        orderCountTotal += project.orderCountDateMap[date]\r\n          ? project.orderCountDateMap[date]\r\n          : 0\r\n        orderCountDaily.push(project.orderCountDateMap[date])\r\n        if (\r\n          project.fundRaisingDateMap[date] &&\r\n          adAccount.fundRaisingSpendDaily[index]\r\n        ) {\r\n          totalRoasDaily.push(\r\n            (\r\n              project.fundRaisingDateMap[date] /\r\n              adAccount.fundRaisingSpendDaily[index]\r\n            ).toFixed(1)\r\n          )\r\n        } else {\r\n          totalRoasDaily.push(0)\r\n        }\r\n      })\r\n      setAdAccount((state) => {\r\n        state.fundRaisingTotal = fundRaisingTotal\r\n        state.fundRaisingDaily = fundRaisingDaily\r\n        state.orderCountTotal = orderCountTotal\r\n        state.orderCountDaily = orderCountDaily\r\n        state.totalRoasDaily = totalRoasDaily\r\n      })\r\n    }\r\n  }, [\r\n    project.fundRaisingDateMap,\r\n    project.orderCountDateMap,\r\n    adAccount.fundRaisingSpendDaily,\r\n    adAccount.dateArray,\r\n    setAdAccount,\r\n  ])\r\n\r\n  useEffect(() => {\r\n    if (project.id) {\r\n      setTabTopic(FUND_RAISING)\r\n    }\r\n  }, [project.id])\r\n\r\n  // 取得備註資料\r\n  useEffect(() => {\r\n    fetch(\r\n      `https://drip-plugin.crowdfunding.coffee/api/adAccountId/${adAccountId}/comment/`\r\n    )\r\n      .then((res) => res.json())\r\n      .then((res) => {\r\n        const commentMap = {}\r\n        res.forEach(({ date, comment }) => {\r\n          commentMap[date] = comment\r\n        })\r\n\r\n        setComment((state) => commentMap)\r\n      })\r\n  }, [adAccountId])\r\n\r\n  useEffect(() => {\r\n    textareaAutoResize()\r\n  }, [user.isLogin, adAccount])\r\n\r\n  // 取得 GA ViewId\r\n  useEffect(() => {\r\n    fetch(\r\n      `https://drip-plugin.crowdfunding.coffee/api/adAccountId/${adAccountId}/ga-viewId`\r\n      // `http://localhost:3050/api/adAccountId/${adAccountId}/ga-viewId`\r\n    )\r\n      .then((res) => res.json())\r\n      .then((res) => {\r\n        if (res.length > 0) {\r\n          res.forEach(({ topic, viewId }) => {\r\n            setGaViewIdMap((state) => {\r\n              state[topic] = viewId\r\n            })\r\n          })\r\n          setFetchLeadGACount((state) => state + 1)\r\n          setFetchFundRaisingGACount((state) => state + 1)\r\n        }\r\n      })\r\n  }, [])\r\n\r\n  return (\r\n    <>\r\n      <div className=\"container my-3\">\r\n        <HeaderContainer title={adAccount.name} />\r\n      </div>\r\n      {loading ? (\r\n        <div className=\"text-center my-5\">\r\n          <div className=\"spinner-border text-primary\" role=\"status\">\r\n            <span className=\"sr-only\">Loading...</span>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* 起迄日期選擇器 */}\r\n          <div className=\"container\">\r\n            <div className=\"row time-range\">\r\n              <div className=\"col-sm-12 col-md-2 time-range__title\">\r\n                資料選取範圍\r\n              </div>\r\n              <div className=\"col-sm-6 col-md-4 time-picker\">\r\n                <label htmlFor=\"timeRangeSince\">開始時間</label>\r\n                <input\r\n                  id=\"timeRangeSince\"\r\n                  type=\"date\"\r\n                  value={timeRangeSince}\r\n                  max={initialUntilDate}\r\n                  onChange={(e) => {\r\n                    setTimeRangeSince(e.target.value)\r\n                  }}\r\n                />\r\n              </div>\r\n              <div className=\"col-sm-6 col-md-4 time-picker\">\r\n                <label htmlFor=\"timeRangeUntil\">結束時間</label>\r\n                <input\r\n                  id=\"timeRangeUntil\"\r\n                  type=\"date\"\r\n                  value={timeRangeUntil}\r\n                  max={initialUntilDate}\r\n                  onChange={(e) => {\r\n                    setTimeRangeUntil(e.target.value)\r\n                  }}\r\n                />\r\n              </div>\r\n              <div className=\"col-sm-12 col-md-2 time-range__button\">\r\n                <div\r\n                  className=\"btn btn-primary btn-block m-1\"\r\n                  onClick={() => {\r\n                    setNumberOfReload((state) => state + 1)\r\n                  }}\r\n                >\r\n                  更新\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {/* GA ViewId */}\r\n          {\r\n            <div className=\"container\">\r\n              <div className=\"row ga-view-id\">\r\n                <div className=\"col-sm-12 col-md-6 ga-view-id-group\">\r\n                  <label htmlFor=\"lead-ga-view-id\">\r\n                    前測問卷{' '}\r\n                    <a\r\n                      target=\"blank\"\r\n                      href=\"https://keyword-hero.com/documentation/finding-your-view-id-in-google-analytics\"\r\n                    >\r\n                      GA View ID\r\n                    </a>\r\n                  </label>\r\n                  <input\r\n                    id=\"lead-ga-view-id\"\r\n                    value={gaViewIdMap[LEAD]}\r\n                    onChange={(event) => {\r\n                      event.persist()\r\n                      setGaViewIdMap((state) => {\r\n                        state[LEAD] = event.target.value\r\n                      })\r\n                    }}\r\n                    disabled={!user.isLogin}\r\n                  />\r\n                  <div\r\n                    className=\"btn btn-primary btn-sm\"\r\n                    onClick={() => {\r\n                      updateGaViewId(LEAD, gaViewIdMap[LEAD])\r\n                      setFetchLeadGACount((state) => state + 1)\r\n                    }}\r\n                  >\r\n                    更新\r\n                  </div>\r\n                </div>\r\n                <div className=\"col-sm-12 col-md-6  ga-view-id-group\">\r\n                  <label htmlFor=\"fund-raising-ga-view-id\">\r\n                    嘖嘖{' '}\r\n                    <a\r\n                      target=\"blank\"\r\n                      href=\"https://keyword-hero.com/documentation/finding-your-view-id-in-google-analytics\"\r\n                    >\r\n                      GA View ID\r\n                    </a>\r\n                  </label>\r\n                  <input\r\n                    id=\"fund-raising-ga-view-id\"\r\n                    value={gaViewIdMap[FUND_RAISING]}\r\n                    onChange={(event) => {\r\n                      event.persist()\r\n                      setGaViewIdMap((state) => {\r\n                        state[FUND_RAISING] = event.target.value\r\n                      })\r\n                    }}\r\n                    disabled={!user.isLogin}\r\n                  />\r\n                  <div\r\n                    className=\"btn btn-primary btn-sm\"\r\n                    onClick={() => {\r\n                      updateGaViewId(FUND_RAISING, gaViewIdMap[FUND_RAISING])\r\n                      setFetchFundRaisingGACount((state) => state + 1)\r\n                    }}\r\n                  >\r\n                    更新\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          }\r\n          {/* 集資資料 */}\r\n          <div className=\"container\">\r\n            <ProjectContainer project={project} adAccount={adAccount} gaViewIdMap={gaViewIdMap} leadGAData={leadGAData}/>\r\n          </div>\r\n          {/* 切換 tab */}\r\n          <div className=\"container\">\r\n            <div\r\n              className={`ad-stats-nav-tabs ${\r\n                tabTopic === LEAD\r\n                  ? 'ad-stats-nav-tabs--lead'\r\n                  : tabTopic === FUND_RAISING\r\n                  ? 'ad-stats-nav-tabs--fund-raising'\r\n                  : tabTopic === BREW\r\n                  ? 'ad-stats-nav-tabs--brew'\r\n                  : ''\r\n              }`}\r\n            >\r\n              <div\r\n                className={`tab__item tab__item--lead ${\r\n                  tabTopic === LEAD ? 'active' : ''\r\n                }`}\r\n                onClick={() => {\r\n                  setTabTopic(LEAD)\r\n                }}\r\n              >\r\n                前測\r\n              </div>\r\n              {project.id && (\r\n                <div\r\n                  className={`tab__item tab__item--fund-raising ${\r\n                    tabTopic === FUND_RAISING ? 'active' : ''\r\n                  }`}\r\n                  onClick={() => {\r\n                    setTabTopic(FUND_RAISING)\r\n                  }}\r\n                >\r\n                  上線\r\n                </div>\r\n              )}\r\n              {brew.isOpen && (\r\n                <div\r\n                  className={`tab__item tab__item--brew ${\r\n                    tabTopic === BREW ? 'active' : ''\r\n                  }`}\r\n                  onClick={() => {\r\n                    setTabTopic(BREW)\r\n                  }}\r\n                >\r\n                  Brew\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          {/* 集資廣告數據 */}\r\n          {project.id && tabTopic === FUND_RAISING && (\r\n            <>\r\n              <div\r\n                className=\"container my-3 line-chart\"\r\n                style={{ height: '300px' }}\r\n              >\r\n                <Line\r\n                  data={fundRaisingLineChartData}\r\n                  options={fundRaisingLineChartOptions}\r\n                />\r\n              </div>\r\n              <div className=\"adAccount__table adAccount__table--fund-raising\">\r\n                <div className=\"adAccount__table-title\">每日數據</div>\r\n                <div className=\"container table-responsive\">\r\n                  <div className=\"tableFixHead\">\r\n                    <table className=\"table\">\r\n                      <thead>\r\n                        <tr>\r\n                          <td>Date</td>\r\n                          <td className=\"table--hide-in-mobile\">\r\n                            每日集資金額\r\n                          </td>\r\n                          <td className=\"table--hide-in-mobile\">每日訂單數</td>\r\n                          <td>上線廣告花費</td>\r\n                          <td>廣告直接轉換金額</td>\r\n                          {gaViewIdMap[FUND_RAISING] && <td>GA 收益</td>}\r\n                          <td>廣告直接 ROAS</td>\r\n                          <td>總體 ROAS</td>\r\n                          {user.isLogin && (\r\n                            <td className=\"table--hide-in-mobile\">備註</td>\r\n                          )}\r\n                        </tr>\r\n                        <tr>\r\n                          <th>總計</th>\r\n                          <th className=\"table--hide-in-mobile\">\r\n                            {format(adAccount.fundRaisingTotal).toDollar()}\r\n                          </th>\r\n                          <th className=\"table--hide-in-mobile\">\r\n                            {format(adAccount.orderCountTotal).toNumber()}\r\n                          </th>\r\n\r\n                          <th>\r\n                            {format(adAccount.fundRaisingSpendTotal).toDollar()}\r\n                          </th>\r\n\r\n                          <th>\r\n                            {format(\r\n                              adAccount.adsDirectFundRaisingTotal\r\n                            ).toDollar()}\r\n                          </th>\r\n                          {gaViewIdMap[FUND_RAISING] && (\r\n                            <th>\r\n                              {format(fundRaisingGAData.total).toDollar()}\r\n                            </th>\r\n                          )}\r\n                          <th>\r\n                            {(\r\n                              adAccount.adsDirectFundRaisingTotal /\r\n                              adAccount.fundRaisingSpendTotal\r\n                            ).toFixed(1)}\r\n                          </th>\r\n                          <th>\r\n                            {(\r\n                              adAccount.fundRaisingTotal /\r\n                              adAccount.fundRaisingSpendTotal\r\n                            ).toFixed(1)}\r\n                          </th>\r\n                          {user.isLogin && (\r\n                            <th className=\"table--hide-in-mobile\"></th>\r\n                          )}\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {adAccount.dateArray.map((date, index) => {\r\n                          const reserveDayCount =\r\n                            adAccount.dateArray.length -\r\n                            project.projectStartIndex -\r\n                            1\r\n                          if (index > reserveDayCount) {\r\n                            return null\r\n                          }\r\n\r\n                          return (\r\n                            <tr key={`daily-adAccount-data-${index}`}>\r\n                              <th>{date.slice(5)}</th>\r\n                              <td className=\"table--hide-in-mobile\">\r\n                                {format(\r\n                                  adAccount.fundRaisingDaily[index]\r\n                                ).toDollar()}\r\n                              </td>\r\n                              <td className=\"table--hide-in-mobile\">\r\n                                {adAccount.orderCountDaily[index]}\r\n                              </td>\r\n                              <td>\r\n                                {format(\r\n                                  adAccount.fundRaisingSpendDaily[index]\r\n                                ).toDollar()}\r\n                              </td>\r\n                              <td>\r\n                                {format(\r\n                                  adAccount.adsDirectFundRaisingDaily[index]\r\n                                ).toDollar()}\r\n                              </td>\r\n                              {gaViewIdMap[FUND_RAISING] && (\r\n                                <td>\r\n                                  {format(fundRaisingGAData[date]).toDollar()}\r\n                                </td>\r\n                              )}\r\n                              <td>{adAccount.adsDirectRoasDaily[index]}</td>\r\n                              <td>{adAccount.totalRoasDaily[index]}</td>\r\n                              {user.isLogin && (\r\n                                <td\r\n                                  className=\"table--hide-in-mobile\"\r\n                                  style={{ padding: '8px' }}\r\n                                >\r\n                                  <textarea\r\n                                    value={comment[date]}\r\n                                    className=\"form-control form-control-sm\"\r\n                                    rows=\"1\"\r\n                                    cols=\"20\"\r\n                                    data-date={date}\r\n                                    style={{ overflowY: 'hidden' }}\r\n                                    onChange={handleCommentInputChange}\r\n                                  />\r\n                                </td>\r\n                              )}\r\n                            </tr>\r\n                          )\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n          {/* 前測廣告數據 */}\r\n          {tabTopic === LEAD && (\r\n            <>\r\n              <div\r\n                className=\"container my-3 line-chart\"\r\n                style={{ height: '300px' }}\r\n              >\r\n                <Line data={leadLineChartData} options={leadLineChartOptions} />\r\n              </div>\r\n              <div className=\"adAccount__table adAccount__table--lead\">\r\n                <div className=\"adAccount__table-title\">每日數據</div>\r\n                <div className=\"container table-responsive\">\r\n                  <div className=\"tableFixHead\">\r\n                    <table className=\"table\">\r\n                      <thead>\r\n                        <tr>\r\n                          <td>Date</td>\r\n                          <td>前測花費</td>\r\n                          <td>名單數(FB)</td>\r\n                          {gaViewIdMap[LEAD] && <td>名單數(GA)</td>}\r\n                          <td>\r\n                            <abbr title=\"分母以 GA 名單優先，沒有 GA 資料再用 FB 名單數\">\r\n                              CPL\r\n                            </abbr>\r\n                          </td>\r\n                          {chatbot && (\r\n                            <td className=\"table--hide-in-mobile\">Chatbot</td>\r\n                          )}\r\n                          {chatbot && (\r\n                            <td\r\n                              title=\"（chatbot/名單數）\"\r\n                              className=\"table--hide-in-mobile\"\r\n                            >\r\n                              訂閱率\r\n                            </td>\r\n                          )}\r\n\r\n                          <td className=\"table--hide-in-mobile\">預熱花費</td>\r\n                          {(user.isLogin ||\r\n                            adAccountId === 'act_318137636023754') && (\r\n                            <td className=\"table--hide-in-mobile\">備註</td>\r\n                          )}\r\n                        </tr>\r\n                        <tr>\r\n                          <th>總計</th>\r\n                          <th>{format(adAccount.leadSpendTotal).toDollar()}</th>\r\n                          <th>{format(adAccount.leadTotal).toNumber()}</th>\r\n                          {gaViewIdMap[LEAD] && (\r\n                            <th>{format(leadGAData.total).toNumber()}</th>\r\n                          )}\r\n                          <th>\r\n                            {gaViewIdMap[LEAD] && leadGAData.total\r\n                              ? (\r\n                                  adAccount.leadSpendTotal / leadGAData.total\r\n                                ).toFixed(1)\r\n                              : (\r\n                                  adAccount.leadSpendTotal / adAccount.leadTotal\r\n                                ).toFixed(1)}\r\n                          </th>\r\n                          {chatbot && (\r\n                            <th className=\"table--hide-in-mobile\">\r\n                              {format(adAccount.chatbotTotal).toNumber()}\r\n                            </th>\r\n                          )}\r\n                          {chatbot && (\r\n                            <th className=\"table--hide-in-mobile\">\r\n                              {format(\r\n                                (\r\n                                  adAccount.chatbotTotal / adAccount.leadTotal\r\n                                ).toFixed(3)\r\n                              ).toPercentage()}\r\n                            </th>\r\n                          )}\r\n                          <th className=\"table--hide-in-mobile\">\r\n                            {format(adAccount.preLaunchSpendTotal).toDollar()}\r\n                          </th>\r\n                          {user.isLogin && (\r\n                            <th className=\"table--hide-in-mobile\"></th>\r\n                          )}\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {adAccount.dateArray.map((date, index) => {\r\n                          const filterDayCount =\r\n                            adAccount.dateArray.length -\r\n                            project.projectStartIndex -\r\n                            1\r\n\r\n                          if (index < filterDayCount) {\r\n                            return null\r\n                          }\r\n                          return (\r\n                            <tr key={`daily-adAccount-data-${index}`}>\r\n                              <th>{date.slice(5)}</th>\r\n                              <td>\r\n                                {format(\r\n                                  adAccount.leadSpendDaily[index]\r\n                                ).toDollar()}\r\n                              </td>\r\n                              <td>\r\n                                {format(adAccount.leadDaily[index]).toNumber()}\r\n                              </td>\r\n                              {gaViewIdMap[LEAD] && (\r\n                                <td>{format(leadGAData[date]).toNumber()}</td>\r\n                              )}\r\n                              <td>\r\n                                {gaViewIdMap[LEAD] && leadGAData.total\r\n                                  ? format(\r\n                                      (\r\n                                        adAccount.leadSpendDaily[index] /\r\n                                        leadGAData[date]\r\n                                      ).toFixed(1)\r\n                                    ).toDollar()\r\n                                  : format(\r\n                                      adAccount.costPerLeadDaily[index]\r\n                                    ).toDollar()}\r\n                              </td>\r\n                              {chatbot && (\r\n                                <td className=\"table--hide-in-mobile\">\r\n                                  {format(chatbot[date]).toNumber()}\r\n                                </td>\r\n                              )}\r\n                              {chatbot && (\r\n                                <td className=\"table--hide-in-mobile\">\r\n                                  {format(\r\n                                    (chatbot[date]\r\n                                      ? chatbot[date] /\r\n                                        adAccount.leadDaily[index]\r\n                                      : 0\r\n                                    ).toFixed(3)\r\n                                  ).toPercentage()}\r\n                                </td>\r\n                              )}\r\n\r\n                              <td className=\"table--hide-in-mobile\">\r\n                                {format(\r\n                                  adAccount.preLaunchSpendDaily[index]\r\n                                ).toDollar()}\r\n                              </td>\r\n                              {user.isLogin && (\r\n                                <td\r\n                                  className=\"table--hide-in-mobile\"\r\n                                  style={{ padding: '8px' }}\r\n                                >\r\n                                  <textarea\r\n                                    value={comment[date]}\r\n                                    className=\"form-control form-control-sm\"\r\n                                    rows=\"1\"\r\n                                    cols=\"20\"\r\n                                    data-date={date}\r\n                                    style={{ overflowY: 'hidden' }}\r\n                                    onChange={handleCommentInputChange}\r\n                                  />\r\n                                </td>\r\n                              )}\r\n                            </tr>\r\n                          )\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n          {/* Brew 廣告數據 */}\r\n          {tabTopic === BREW && (\r\n            <>\r\n              <div\r\n                className=\"container my-3 line-chart\"\r\n                style={{ height: '300px' }}\r\n              >\r\n                <Line data={brewLineChartData} options={brewLineChartOptions} />\r\n              </div>\r\n              <div className=\"adAccount__table adAccount__table--brew\">\r\n                <div className=\"adAccount__table-title\">每日數據</div>\r\n                <div className=\"container table-responsive\">\r\n                  <div className=\"tableFixHead\">\r\n                    <table className=\"table\">\r\n                      <thead>\r\n                        <tr>\r\n                          <td>Date</td>\r\n                          <td className=\"table--hide-in-mobile\">\r\n                            每日集資金額\r\n                          </td>\r\n                          <td className=\"table--hide-in-mobile\">每日訂單數</td>\r\n                          <td>上線廣告花費</td>\r\n                          <td>廣告直接轉換金額</td>\r\n                          <td>廣告直接 ROAS</td>\r\n                          <td>總體 ROAS</td>\r\n                          {user.isLogin && (\r\n                            <td className=\"table--hide-in-mobile\">備註</td>\r\n                          )}\r\n                        </tr>\r\n                        <tr>\r\n                          <th>總計</th>\r\n                          <th className=\"table--hide-in-mobile\">\r\n                            {format(brew.totalOrderSum).toDollar()}\r\n                          </th>\r\n                          <th className=\"table--hide-in-mobile\">\r\n                            {format(brew.totalOrderCount).toNumber()}\r\n                          </th>\r\n                          <th>\r\n                            {format(\r\n                              adAccount.brewData.brewAdsSpendTotal\r\n                            ).toDollar()}\r\n                          </th>\r\n                          <th>\r\n                            {format(\r\n                              adAccount.brewData.brewAdsRevenueTotal\r\n                            ).toDollar()}\r\n                          </th>\r\n                          <th>\r\n                            {(\r\n                              adAccount.brewData.brewAdsRevenueTotal /\r\n                              adAccount.brewData.brewAdsSpendTotal\r\n                            ).toFixed(1)}\r\n                          </th>\r\n                          <th>\r\n                            {(\r\n                              brew.totalOrderSum /\r\n                              adAccount.brewData.brewAdsSpendTotal\r\n                            ).toFixed(1)}\r\n                          </th>\r\n                          {user.isLogin && (\r\n                            <th className=\"table--hide-in-mobile\"></th>\r\n                          )}\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {brew.orderStatsDaily.map(\r\n                          ({ date, orderSum, orderCount }) => {\r\n                            return (\r\n                              <tr key={`daily-adAccount-data-${date}`}>\r\n                                <th>{date.slice(5)}</th>\r\n                                <td className=\"table--hide-in-mobile\">\r\n                                  {format(orderSum).toDollar()}\r\n                                </td>\r\n                                <td className=\"table--hide-in-mobile\">\r\n                                  {orderCount}\r\n                                </td>\r\n                                <td>\r\n                                  {format(\r\n                                    adAccount.brewData[date]?.spend\r\n                                  ).toDollar()}\r\n                                </td>\r\n                                <td>\r\n                                  {format(\r\n                                    adAccount.brewData[date]?.revenue\r\n                                  ).toDollar()}\r\n                                </td>\r\n                                <td>\r\n                                  {(\r\n                                    adAccount.brewData[date]?.revenue /\r\n                                    adAccount.brewData[date]?.spend\r\n                                  ).toFixed(1)}\r\n                                </td>\r\n                                <td>\r\n                                  {(\r\n                                    orderSum / adAccount.brewData[date]?.spend\r\n                                  ).toFixed(1)}\r\n                                </td>\r\n                                {user.isLogin && (\r\n                                  <td\r\n                                    className=\"table--hide-in-mobile\"\r\n                                    style={{ padding: '8px' }}\r\n                                  >\r\n                                    <textarea\r\n                                      value={comment[date]}\r\n                                      className=\"form-control form-control-sm\"\r\n                                      rows=\"1\"\r\n                                      cols=\"20\"\r\n                                      data-date={date}\r\n                                      style={{ overflowY: 'hidden' }}\r\n                                      onChange={handleCommentInputChange}\r\n                                    />\r\n                                  </td>\r\n                                )}\r\n                              </tr>\r\n                            )\r\n                          }\r\n                        )}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n    </>\r\n  )\r\n\r\n  function handleCommentInputChange(event) {\r\n    const value = event.target.value\r\n    const date = event.target.dataset.date\r\n    // event.target.style.height = event.target.scrollHeight + 'px'\r\n    setComment((state) => ({\r\n      ...state,\r\n      [date]: value,\r\n    }))\r\n    updateCommentCallback(value, date)\r\n  }\r\n\r\n  function updateComment(comment, date) {\r\n    fetch(`https://drip-plugin.crowdfunding.coffee/api/comment/insert`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        adAccountId,\r\n        date,\r\n        comment,\r\n      }),\r\n    })\r\n  }\r\n\r\n  function updateGaViewId(topic, viewId) {\r\n    fetch(\r\n      `https://drip-plugin.crowdfunding.coffee/api/ga-viewId/create-or-update`,\r\n      // `http://localhost:3050/api/ga-viewId/create-or-update`\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          adAccountId,\r\n          topic,\r\n          viewId,\r\n        }),\r\n      }\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = ({ user }) => ({\r\n  user,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch) => bindActionCreators({}, dispatch)\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(AdAccount)\r\n","import React from 'react'\nimport { Router } from '@reach/router'\n\n// utils\n\n// assets\n\n// actions\n\n// components\nimport Home from './Home'\nimport AdAccount from './AdAccount'\n\n// self-defined-components\nconst App = () => {\n  return (\n    <Router basepath=\"/\" primary={false}>\n      <Home path='/' />\n      <AdAccount path='/ad-account/:adAccountId' />\n    </Router>\n  )\n}\n\nexport default App\n","import { combineReducers } from 'redux'\r\nimport userReducer from '../features/user/userSlice'\r\nimport adAccountsReducer from '../features/adAccounts/adAccountsSlice'\r\n\r\nexport default combineReducers({\r\n  user: userReducer,\r\n  adAccounts: adAccountsReducer,\r\n})\r\n","import { call, put, takeLatest } from 'redux-saga/effects'\r\nimport { setUser, fetchUserAndAdAccountsAsync } from './userSlice'\r\nimport { setAdAccounts } from '../adAccounts/adAccountsSlice'\r\n\r\nexport function* fetchUserAndAdAccountsAsyncSaga({ payload }) {\r\n  try {\r\n    yield put(setUser({ isLoading: true }))\r\n    yield put(setAdAccounts({ isLoading: true }))\r\n\r\n    const response = yield call(() => {\r\n      return new Promise((resolve) => {\r\n        window.FB.api(\r\n          '/me?fields=name,picture{url},adaccounts.limit(1000){age,name,amount_spent,campaigns.limit(1000){status,name}}',\r\n          function (res) {\r\n            resolve(res)\r\n          }\r\n        )\r\n      })\r\n    })\r\n\r\n    if(response.error) {\r\n      yield put(setUser({isNoAuth: true}))\r\n      yield put(setAdAccounts({data: []}))\r\n    } else {\r\n      const userData = {\r\n        name: response.name,\r\n        pictureURL: response.picture.data.url,\r\n        isLogin: true,\r\n      }\r\n      const adAccounts = {\r\n        data: formatAdAccounts(response.adaccounts.data),\r\n      }\r\n  \r\n      yield put(setUser(userData))\r\n      yield put(setAdAccounts(adAccounts))\r\n    }\r\n\r\n    yield put(setUser({ isLoading: false }))\r\n    yield put(setAdAccounts({ isLoading: false }))\r\n  } catch (error) {\r\n    yield put(setUser({ isLoading: false }))\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nfunction formatAdAccounts(AdAccounts) {\r\n  let sortedAdAccountsData = AdAccounts.sort((a, b) => a.age - b.age)\r\n\r\n  // 遍歷廣告活動狀態，在廣告帳戶物件加上 adAccountLive 屬性\r\n  sortedAdAccountsData = sortedAdAccountsData.map((adAccount) => {\r\n    adAccount.adAccountLive = false\r\n    adAccount.campaignStatus = { name: '', value: 0 }\r\n\r\n    if (adAccount.campaigns) {\r\n      adAccount.campaigns.data.forEach((adCampaign) => {\r\n        if (adCampaign.status === 'ACTIVE') {\r\n          adAccount.adAccountLive = true\r\n        }\r\n        adAccount.campaignStatus = handleAdCampaignStatus(\r\n          adAccount.campaignStatus,\r\n          adCampaign.name\r\n        )\r\n      })\r\n    }\r\n    return adAccount\r\n  })\r\n\r\n  return sortedAdAccountsData\r\n}\r\n\r\nfunction handleAdCampaignStatus(originalStatus, adCampaignName) {\r\n  // 狀態變成數字來比大小\r\n  // 較大的為現在的狀態\r\n  const newStatus = getAdCampaignStatus(adCampaignName)\r\n  return newStatus.value > originalStatus.value ? newStatus : originalStatus\r\n}\r\n\r\nfunction getAdCampaignStatus(adCampaignName) {\r\n  return adCampaignName.includes('上線')\r\n    ? { name: '上線', value: 3 }\r\n    : adCampaignName.includes('預熱')\r\n    ? { name: '預熱', value: 2 }\r\n    : adCampaignName.includes('前測')\r\n    ? { name: '前測', value: 1 }\r\n    : { name: '', value: 0 }\r\n}\r\n\r\nexport default function* productSaga() {\r\n  yield takeLatest(fetchUserAndAdAccountsAsync, fetchUserAndAdAccountsAsyncSaga)\r\n}\r\n","import { all } from 'redux-saga/effects'\r\n\r\nimport userSaga from '../features/user/userSaga'\r\n\r\nexport default function* rootSaga() {\r\n  yield all([userSaga()])\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './pages/App'\r\nimport { configureStore } from '@reduxjs/toolkit'\r\nimport { Provider } from 'react-redux'\r\nimport rootReducer from './reducers'\r\nimport rootSaga from './sagas'\r\nimport createSagaMiddleware from 'redux-saga'\r\n\r\nimport 'bootstrap/dist/css/bootstrap.min.css'\r\n\r\nconst sagaMiddleware = createSagaMiddleware()\r\n\r\nconst store = configureStore({\r\n  reducer: rootReducer,\r\n  middleware: [sagaMiddleware],\r\n})\r\n\r\nsagaMiddleware.run(rootSaga)\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <React.StrictMode>\r\n      <App />\r\n    </React.StrictMode>\r\n  </Provider>,\r\n  document.getElementById('root')\r\n)\r\n"],"sourceRoot":""}