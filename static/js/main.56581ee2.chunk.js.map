{"version":3,"sources":["pages/Home.js","pages/AdAccount.js","pages/App.js","index.js"],"names":["Home","useState","adAccounts","setAdAccounts","user","setUser","useEffect","window","checkLoginState","FB","getLoginStatus","res","console","log","status","state","isLogin","api","name","pictureURL","picture","data","url","adaccounts","fbAsyncInit","init","appId","cookie","xfbml","version","AppEvents","logPageView","d","s","id","js","fjs","getElementsByTagName","getElementById","createElement","src","parentNode","insertBefore","document","className","onClick","logout","response","alt","style","width","data-size","data-button-type","data-layout","data-auto-logout-link","data-use-continue-as","data-width","data-onlogin","data-scope","display","length","map","key","type","navigate","AdAccount","adAccountId","loading","setLoading","useImmer","adAccount","setAdAccount","paging","setPaging","lineChartData","labels","date_start","reverse","datasets","label","fill","lineTension","backgroundColor","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","pointBorderColor","pointBackgroundColor","pointBorderWidth","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointRadius","pointHitRadius","purchase_roas","value","costPerLead","cost_per_action_type","find","item","action_type","fetchData","role","height","options","maintainAspectRatio","scope","index","cpc","spend","hasPrevious","cursors","before","hasNext","after","cursorKey","cursorValue","fetch","then","json","account_name","App","basepath","primary","path","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.56581ee2.chunk.js","sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { navigate } from '@reach/router'\r\n\r\nfunction Home() {\r\n  const [adAccounts, setAdAccounts] = useState([])\r\n  const [user, setUser] = useState({})\r\n\r\n  useEffect(() => {\r\n    window.checkLoginState = function () {\r\n      window.FB\r\n        ? window.FB.getLoginStatus((res) => {\r\n            console.log(res)\r\n\r\n            if (res.status === 'connected') {\r\n              // Logged into your webpage and Facebook.\r\n              setUser((state) => ({\r\n                ...state,\r\n                isLogin: true,\r\n              }))\r\n\r\n              console.log('fetchUserAndAdAccounts')\r\n              fetchUserAndAdAccounts()\r\n            } else {\r\n              // Not logged into your webpage or we are unable to tell.\r\n              console.log('Please log into this webpage.')\r\n            }\r\n          })\r\n        : console.log('FB not loaded.')\r\n    }\r\n    window.checkLoginState()\r\n\r\n    window.fbAsyncInit = function () {\r\n      window.FB.init({\r\n        appId: '2772453809519165',\r\n        cookie: true,\r\n        xfbml: true,\r\n        version: 'v6.0',\r\n      })\r\n\r\n      window.FB.AppEvents.logPageView()\r\n      window.checkLoginState()\r\n    }\r\n    ;(function (d, s, id) {\r\n      var js,\r\n        fjs = d.getElementsByTagName(s)[0]\r\n      if (d.getElementById(id)) {\r\n        return\r\n      }\r\n      js = d.createElement(s)\r\n      js.id = id\r\n      js.src =\r\n        'https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=2772453809519165&autoLogAppEvents=1'\r\n      fjs.parentNode.insertBefore(js, fjs)\r\n    })(document, 'script', 'facebook-jssdk')\r\n  }, [])\r\n\r\n  return (\r\n    <div className='container my-3'>\r\n      {/* Avatar、登出 */}\r\n      {user.pictureURL ? (\r\n        <div className='text-right my-3'>\r\n          <div\r\n            className='btn btn-primary'\r\n            onClick={() =>\r\n              window.FB.logout(function (response) {\r\n                setUser({})\r\n                setAdAccounts([])\r\n              })\r\n            }\r\n          >\r\n            <div className=' d-flex align-items-center'>\r\n              <img\r\n                src={user.pictureURL}\r\n                alt='avatar'\r\n                className='rounded-circle'\r\n                style={{ width: '30px' }}\r\n              />\r\n              <span className='mx-2'>登出</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        ''\r\n      )}\r\n      <h1 className='text-center my-3'>廣告帳號</h1>\r\n      {/* 臉書登入 */}\r\n      <div className='w-100 text-center my-3'>\r\n        <div\r\n          className='fb-login-button'\r\n          data-size='large'\r\n          data-button-type='continue_with'\r\n          data-layout='default'\r\n          data-auto-logout-link='false'\r\n          data-use-continue-as='true'\r\n          data-width=''\r\n          data-onlogin='checkLoginState();'\r\n          data-scope='public_profile,email,ads_read,business_management'\r\n          style={{ display: user.isLogin ? 'none' : 'block' }}\r\n        ></div>\r\n      </div>\r\n\r\n      {/* 廣告帳戶列表 */}\r\n      <main className='col-12 col-md-6 m-auto'>\r\n        {adAccounts.length > 0 ? (\r\n          <div className='list-group'>\r\n            {adAccounts.map(({ name, id }) => (\r\n              <button\r\n                key={id}\r\n                type='button'\r\n                className='list-group-item list-group-item-action'\r\n                onClick={() => navigate(`/ad-account/${id}`)}\r\n              >\r\n                {name}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          ''\r\n        )}\r\n      </main>\r\n    </div>\r\n  )\r\n\r\n  function fetchUserAndAdAccounts() {\r\n    window.FB.api(\r\n      '/me?fields=name,picture{url},adaccounts{name,account_id,age}',\r\n      function (res) {\r\n        setUser((state) => ({\r\n          ...state,\r\n          name: res.name,\r\n          pictureURL: res.picture.data.url,\r\n        }))\r\n        setAdAccounts(res.adaccounts.data)\r\n      }\r\n    )\r\n  }\r\n}\r\n\r\nexport default Home\r\n","import React, { useEffect, useState } from 'react'\r\nimport { useImmer } from 'use-immer'\r\nimport { Line } from 'react-chartjs-2'\r\nimport { navigate } from '@reach/router'\r\n\r\nfunction AdAccount({ adAccountId }) {\r\n  const [loading, setLoading] = useState(true)\r\n  const [adAccount, setAdAccount] = useImmer({ data: [] })\r\n  const [paging, setPaging] = useState({})\r\n  const lineChartData = {\r\n    labels: adAccount.data.map(({ date_start }) => date_start).reverse(),\r\n    datasets: [\r\n      {\r\n        label: 'ROAS',\r\n        fill: false,\r\n        lineTension: 0.1,\r\n        backgroundColor: 'rgba(75,192,192,0.4)',\r\n        borderColor: 'rgba(75,192,192,1)',\r\n        borderCapStyle: 'butt',\r\n        borderDash: [],\r\n        borderDashOffset: 0.0,\r\n        borderJoinStyle: 'miter',\r\n        pointBorderColor: 'rgba(75,192,192,1)',\r\n        pointBackgroundColor: '#fff',\r\n        pointBorderWidth: 1,\r\n        pointHoverRadius: 5,\r\n        pointHoverBackgroundColor: 'rgba(75,192,192,1)',\r\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\r\n        pointHoverBorderWidth: 2,\r\n        pointRadius: 1,\r\n        pointHitRadius: 10,\r\n        data: adAccount.data\r\n          .map(({ purchase_roas }) =>\r\n            purchase_roas ? purchase_roas[0].value : null\r\n          )\r\n          .reverse(),\r\n      },\r\n      {\r\n        label: 'CPL',\r\n        fill: false,\r\n        lineTension: 0.1,\r\n        backgroundColor: 'rgba(75,192,192,0.4)',\r\n        borderColor: '#666',\r\n        borderCapStyle: 'butt',\r\n        borderDash: [],\r\n        borderDashOffset: 0.0,\r\n        borderJoinStyle: 'miter',\r\n        pointBorderColor: '#666',\r\n        pointBackgroundColor: '#fff',\r\n        pointBorderWidth: 1,\r\n        pointHoverRadius: 5,\r\n        pointHoverBackgroundColor: '#666',\r\n        pointHoverBorderColor: 'rgba(220,220,220,1)',\r\n        pointHoverBorderWidth: 2,\r\n        pointRadius: 1,\r\n        pointHitRadius: 10,\r\n        data: adAccount.data\r\n          .map(({ cost_per_action_type }) => {\r\n            const costPerLead = cost_per_action_type.find(\r\n              (item) =>\r\n                item.action_type === 'offsite_conversion.fb_pixel_custom'\r\n            )\r\n            return costPerLead ? costPerLead.value : null\r\n          })\r\n          .reverse(),\r\n      },\r\n    ],\r\n  }\r\n\r\n  useEffect(() => {\r\n    fetchData()\r\n  }, [adAccountId])\r\n\r\n  return (\r\n    <div className='container my-3'>\r\n      {loading ? (\r\n        <div className='text-center my-5'>\r\n          <div className='spinner-border text-primary' role='status'>\r\n            <span className='sr-only'>Loading...</span>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          <div className='btn btn-primary' onClick={() => navigate('/')}>\r\n            Home\r\n          </div>\r\n          <h1 className='text-center my-3'>{adAccount.name}</h1>\r\n\r\n          {/* 圖表 */}\r\n          <div className='my-2' style={{ height: '200px' }}>\r\n            <Line\r\n              data={lineChartData}\r\n              options={{ maintainAspectRatio: false }}\r\n            />\r\n          </div>\r\n\r\n          {/* 走速表 */}\r\n          {adAccountId ? (\r\n            <table className='table'>\r\n              <thead>\r\n                <tr>\r\n                  <th scope='col'>Date</th>\r\n                  <th scope='col'>Spend</th>\r\n                  <th scope='col'>CPC</th>\r\n                  <th scope='col'>CPL</th>\r\n                  <th scope='col'>ROAS</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {adAccount.data.map(\r\n                  (\r\n                    {\r\n                      cpc,\r\n                      spend,\r\n                      date_start,\r\n                      purchase_roas,\r\n                      cost_per_action_type,\r\n                    },\r\n                    index\r\n                  ) => {\r\n                    const costPerLead = cost_per_action_type.find(\r\n                      (item) =>\r\n                        item.action_type ===\r\n                        'offsite_conversion.fb_pixel_custom'\r\n                    )\r\n\r\n                    return (\r\n                      <tr key={`daily-adAccount-data-${index}`}>\r\n                        <th>{date_start}</th>\r\n                        <td>{spend}</td>\r\n                        <td>{cpc}</td>\r\n                        <td>{costPerLead ? costPerLead.value : null}</td>\r\n                        <td>{purchase_roas ? purchase_roas[0].value : ''}</td>\r\n                      </tr>\r\n                    )\r\n                  }\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          ) : (\r\n            ''\r\n          )}\r\n          {/* Paging */}\r\n          <div className='row'>\r\n            <div className='col-6 text-left'>\r\n              {paging.hasPrevious ? (\r\n                <div\r\n                  className='btn btn-primary'\r\n                  onClick={() => fetchData('before', paging.cursors.before)}\r\n                >\r\n                  Previous\r\n                </div>\r\n              ) : (\r\n                ''\r\n              )}\r\n            </div>\r\n            <div className='col-6 text-right'>\r\n              {paging.hasNext ? (\r\n                <div\r\n                  className='btn btn-primary'\r\n                  onClick={() => fetchData('after', paging.cursors.after)}\r\n                >\r\n                  Next\r\n                </div>\r\n              ) : (\r\n                ''\r\n              )}\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  )\r\n\r\n  function fetchData(cursorKey = '', cursorValue = '') {\r\n    setLoading(true)\r\n    fetch(\r\n      `http://localhost:8000/ad-account/${adAccountId}?${cursorKey}=${cursorValue}`\r\n    )\r\n      .then((res) => res.json())\r\n      .then((res) => {\r\n        console.log(res)\r\n        setAdAccount((state) => {\r\n          state.data = res.data\r\n          state.name = res.data[0].account_name\r\n        })\r\n        setPaging(res.paging)\r\n        setLoading(false)\r\n      })\r\n  }\r\n}\r\n\r\nexport default AdAccount\r\n","import React from 'react'\nimport { Router } from '@reach/router'\n\n// utils\n\n// assets\n\n// actions\n\n// components\nimport Home from './Home'\nimport AdAccount from './AdAccount'\n\n// self-defined-components\nconst App = () => {\n  return (\n    <Router basepath=\"/facebook-ad-account-dashboard\" primary={false}>\n      <Home path='/' />\n      <AdAccount path='/ad-account/:adAccountId' />\n    </Router>\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './pages/App'\n\nimport 'bootstrap/dist/css/bootstrap.min.css'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}