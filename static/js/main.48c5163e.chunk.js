(this["webpackJsonpmixxin-dashboard"]=this["webpackJsonpmixxin-dashboard"]||[]).push([[0],{100:function(e,a,t){e.exports=t(208)},110:function(e,a,t){},111:function(e,a,t){},205:function(e,a,t){},208:function(e,a,t){"use strict";t.r(a);var n=t(0),l=t.n(n),c=t(96),r=t.n(c),o=t(46),i=t(43),s=t(38),u=t(32);function d(e){return{toDollar:function(){return e?"NTD ".concat(e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")):""},toNumber:function(){return e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):""},toProjectTime:function(){var a=e.split("T"),t=Object(u.a)(a,2),n=t[0],l=t[1];return e?"".concat(n," ").concat(l.substring(0,5)):""},toDate:function(){var a=new Date(e),t=a.getFullYear(),n=("0"+(a.getMonth()+1)).slice(-2),l=("0"+a.getDate()).slice(-2);return e?"".concat(t,"-").concat(n,"-").concat(l):""},toTime:function(){var a=new Date(e),t=("0"+a.getHours()).slice(-2),n=("0"+a.getMinutes()).slice(-2);return e?"".concat(t,":").concat(n):""}}}t(110),t(111);var m=function(e){var a=e.labelFor,t=e.isOn,n=e.handleToggle,c=e.onColor;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"switch-container"},l.a.createElement("input",{checked:t,onChange:n,className:"react-switch-checkbox",id:"react-switch-"+a,type:"checkbox"}),l.a.createElement("label",{style:{background:t&&c},className:"react-switch-label",htmlFor:"react-switch-"+a},l.a.createElement("span",{className:"react-switch-button"}))))};var p=function(){var e=Object(n.useState)([]),a=Object(u.a)(e,2),t=a[0],c=a[1],r=Object(n.useState)({}),p=Object(u.a)(r,2),f=p[0],g=p[1],h=Object(n.useState)(!0),E=Object(u.a)(h,2),b=E[0],y=E[1],v=b?t.filter((function(e){return e.adAccountLive})):t;return v=v.sort((function(e,a){return a.campaignStatus.value-e.campaignStatus.value})),Object(n.useEffect)((function(){window.checkLoginState=function(){window.FB?window.FB.getLoginStatus((function(e){console.log(e),"connected"===e.status?(g((function(e){return Object(s.a)(Object(s.a)({},e),{},{isLogin:!0})})),console.log("fetchUserAndAdAccounts"),window.FB.api("/me?fields=name,picture{url},adaccounts.limit(1000){age,name,amount_spent,campaigns.limit(1000){status,name}}",(function(e){g((function(a){return Object(s.a)(Object(s.a)({},a),{},{name:e.name,pictureURL:e.picture.data.url})}));var a=e.adaccounts.data.sort((function(e,a){return e.age-a.age}));console.log(a),a=a.map((function(e){return e.adAccountLive=!1,e.campaignStatus={name:"",value:0},e.campaigns&&e.campaigns.data.forEach((function(a){"ACTIVE"===a.status&&(e.adAccountLive=!0),e.campaignStatus=function(e,a){var t=function(e){return e.includes("\u4e0a\u7dda")?{name:"\u4e0a\u7dda",value:3}:e.includes("\u9810\u71b1")?{name:"\u9810\u71b1",value:2}:e.includes("\u524d\u6e2c")?{name:"\u524d\u6e2c",value:1}:{name:"",value:0}}(a);return t.value>e.value?t:e}(e.campaignStatus,a.name)})),e})),c((function(e){return Object(i.a)(a)}))}))):console.log("Please log into this webpage.")})):console.log("FB not loaded.")},window.checkLoginState(),window.fbAsyncInit=function(){window.FB.init({appId:"2772453809519165",cookie:!0,xfbml:!0,version:"v6.0"}),window.FB.AppEvents.logPageView(),window.checkLoginState()},function(e,a,t){var n,l=e.getElementsByTagName(a)[0];e.getElementById(t)||((n=e.createElement(a)).id=t,n.src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v7.0&appId=2772453809519165&autoLogAppEvents=1",l.parentNode.insertBefore(n,l))}(document,"script","facebook-jssdk")}),[]),l.a.createElement("div",{className:"container my-3"},f.pictureURL?l.a.createElement("div",{className:"text-right my-3"},l.a.createElement("div",{className:"btn btn-primary",onClick:function(){return window.FB.logout((function(e){g({}),c([])}))}},l.a.createElement("div",{className:" d-flex align-items-center"},l.a.createElement("img",{src:f.pictureURL,alt:"avatar",className:"rounded-circle",style:{width:"30px"}}),l.a.createElement("span",{className:"mx-2"},"\u767b\u51fa")))):"",l.a.createElement("h1",{className:"text-center my-3"},"\u5ee3\u544a\u5e33\u865f"),l.a.createElement("div",{className:"w-100 text-center my-3"},l.a.createElement("div",{className:"fb-login-button","data-size":"large","data-button-type":"continue_with","data-layout":"default","data-auto-logout-link":"false","data-use-continue-as":"true","data-width":"","data-onlogin":"checkLoginState();","data-scope":"public_profile,email,ads_read,business_management",style:{display:f.isLogin?"none":"block"}})),v.length>0?l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"d-flex align-items-center justify-content-center my-2"},l.a.createElement(m,{labelFor:"isFilter",isOn:b,handleToggle:function(){return y(!b)},onColor:"#e43f5a"}),l.a.createElement("span",null,"\u53ea\u986f\u793a Active \u5ee3\u544a\u5e33\u6236")),l.a.createElement("main",{className:"d-flex flex-wrap justify-content-center"},v.map((function(e){var a=e.name,t=e.id,n=e.adAccountLive,c=e.campaignStatus,r=e.amount_spent;return l.a.createElement("div",{key:t,className:"card m-1 ad-account-card",style:{width:"18rem",opacity:!n&&.3}},l.a.createElement("div",{className:"card-body",onClick:function(){return Object(o.b)("/facebook-ad-account-dashboard/ad-account/".concat(t))}},l.a.createElement("span",{className:"badge badge-"+(3===c.value?"success":2===c.value?"primary":1===c.value?"secondary":"")},c.name),l.a.createElement("h5",{className:"card-title"},a),l.a.createElement("p",{className:"card-text"},"\u7e3d\u5ee3\u544a\u82b1\u8cbb\uff1a",d(r).toDollar())))})))):"")},f=t(63),g=t(77),h=t(75);t(204),t(205);var E=function(e){var a=e.adAccountId,t=Object(n.useState)(!0),c=Object(u.a)(t,2),r=c[0],m=c[1],p=Object(g.a)({name:"",platformId:"",projectId:"",data:[],dateArray:[],leadSpendTotal:0,leadSpendDaily:[],leadTotal:0,leadDaily:[],costPerLeadDaily:[],preLaunchSpendTotal:0,preLaunchSpendDaily:[],fundRaisingSpendTotal:0,fundRaisingSpendDaily:[],adsDirectFundRaisingTotal:0,adsDirectFundRaisingDaily:[],adsDirectRoasDaily:[],fundRaisingTotal:0,fundRaisingDaily:[],orderCountTotal:0,orderCountDaily:[],totalRoasDaily:[]}),E=Object(u.a)(p,2),b=E[0],y=E[1],v=Object(g.a)({started_at:void 0,fundRaisingDateMap:void 0,orderCountDateMap:void 0}),D=Object(u.a)(v,2),j=D[0],S=D[1],N={maintainAspectRatio:!1,hover:{intersect:!1},tooltips:{mode:"index",intersect:!1},scales:{yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1",gridLines:{drawOnChartArea:!1},scaleLabel:{display:!0,labelString:"\u540d\u55ae\u53d6\u5f97\u6210\u672c"}},{type:"linear",display:!0,position:"right",id:"y-axis-2",scaleLabel:{display:!0,labelString:"ROAS"}}]},plugins:{datalabels:{color:"black",align:"top",offset:8}}},R={labels:Object(i.a)(b.dateArray).reverse(),datasets:[{label:"CPL",fill:!1,borderColor:"#1f4068",pointBackgroundColor:"#1f4068",pointHoverBackgroundColor:"#1f4068",data:Object(i.a)(b.costPerLeadDaily).reverse(),yAxisID:"y-axis-1"}]},w={labels:Object(i.a)(b.dateArray).reverse(),datasets:[{label:"\u7e3d\u9ad4 ROAS",fill:!1,borderColor:"#e43f5a",pointBackgroundColor:"#e43f5a",pointHoverBackgroundColor:"#e43f5a",data:Object(i.a)(b.totalRoasDaily).reverse(),yAxisID:"y-axis-2"}]};return Object(n.useEffect)((function(){fetch("https://fb-ads-api.herokuapp.com/ad-account/info/".concat(a)).then((function(e){return e.json()})).then((function(e){y((function(a){a.name=e.name,a.platformId=e.business_street,a.projectId=e.business_street2}))})),m(!0),fetch("https://fb-ads-api.herokuapp.com/ad-account/insights/".concat(a)).then((function(e){return e.json()})).then((function(e){y((function(a){a.data=function(e){var a={};return e.forEach((function(e){var t=e.date_start,n=function(e){return e.campaign_name.includes("\u9810\u71b1")?"\u9810\u71b1":e.campaign_name.includes("\u524d\u6e2c")?"\u524d\u6e2c":e.campaign_name.includes("\u4e0a\u7dda")?"\u4e0a\u7dda":"none"}(e);a[t]?a[t][n]?a[t][n].push(e):a[t][n]=[e]:a[t]=Object(f.a)({},n,[e])})),a}(e.data)})),m(!1)}))}),[a,y]),Object(n.useEffect)((function(){!function(){var e=Object.keys(b.data),a=0,t=[],n=0,l=[],c=[],r=0,o=[],i=0,s=[],u=0,d=[],m=[];Object.values(b.data).forEach((function(e){if(e["\u9810\u71b1"]){var p=e["\u9810\u71b1"],f=0;p.forEach((function(e){if(0!==parseInt(e.spend)){var a=parseInt(e.spend);f+=a}})),0!==f?(r+=f,o.push(f)):o.push(null)}else o.push(null);if(e["\u524d\u6e2c"]){var g=e["\u524d\u6e2c"],h=0,E=0;g.forEach((function(e){if(0!==parseInt(e.spend)&&e.actions){var a=parseInt(e.spend),t=e.actions.find((function(e){return"offsite_conversion.fb_pixel_custom"===e.action_type||"lead"===e.action_type}));h+=a,E+=t?parseInt(t.value):0}})),0!==h&&0!==E?(a+=h,t.push(h),n+=E,l.push(E),c.push((h/E).toFixed(1))):(t.push(null),l.push(null),c.push(null))}else t.push(null),l.push(null),c.push(null);if(e["\u4e0a\u7dda"]){var b=e["\u4e0a\u7dda"],y=0,v=0;b.forEach((function(e){if(0!==parseInt(e.spend)&&e.action_values){var a=parseInt(e.spend),t=e.action_values.find((function(e){return"omni_purchase"===e.action_type}));y+=a,v+=t?parseInt(t.value):0}})),0!==y&&0!==v?(i+=y,s.push(y),u+=v,d.push(v),m.push((v/y).toFixed(1))):(s.push(null),d.push(null),m.push(null))}else s.push(null),d.push(null),m.push(null)})),y((function(p){p.dateArray=e,p.leadSpendTotal=a,p.leadSpendDaily=t,p.leadTotal=n,p.leadDaily=l,p.costPerLeadDaily=c,p.preLaunchSpendTotal=r,p.preLaunchSpendDaily=o,p.fundRaisingSpendTotal=i,p.fundRaisingSpendDaily=s,p.adsDirectFundRaisingTotal=u,p.adsDirectFundRaisingDaily=d,p.adsDirectRoasDaily=m}))}()}),[b.data,y]),Object(n.useEffect)((function(){var e=b.platformId,a=b.projectId;e&&a&&function(e,a){fetch("https://drip.zectrack.today/api/platform/".concat(e,"/projects/").concat(a)).then((function(e){return e.json()})).then((function(e){S((function(a){return Object(s.a)(Object(s.a)(Object(s.a)({},a),e),{},{timeline:JSON.parse(e.timeline).sort((function(e,a){return e[0]-a[0]})),sponsor_count:d(e.sponsor_count).toNumber(),funding_target:d(e.funding_target).toDollar(),funding_current:d(e.funding_current).toDollar(),started_at:d(e.started_at).toProjectTime(),finished_at:d(e.finished_at).toProjectTime()})}))}))}(e,a)}),[b.platformId,b.projectId,S]),Object(n.useEffect)((function(){if(j.timeline){var e=new Date(j.started_at.slice(0,-1)).getTime()/1e3,a=new Date(j.finished_at.slice(0,-1)).getTime()/1e3;e-=3600;var t={};j.timeline.forEach((function(n){if(!(n[0]<e||n[0]>a)){var l=d(1e3*n[0]).toDate(),c=[d(1e3*n[0]).toTime(),n[1],n[2]];t[l]?t[l].push(c):t[l]=[c]}}));for(var n={},l={},c=0,r=0,o=0,i=Object.entries(t);o<i.length;o++){var s=Object(u.a)(i[o],2),m=s[0],p=s[1],f=p[p.length-1][2],g=p[p.length-1][1];n[m]=f-c,l[m]=g-r,c=f,r=g}S((function(e){e.fundRaisingDateMap=n,e.orderCountDateMap=l}))}}),[j.timeline,j.started_at,j.finished_at,S]),Object(n.useEffect)((function(){if(j.fundRaisingDateMap&&b.fundRaisingSpendDaily.length>0){var e=0,a=[],t=0,n=[],l=[];b.dateArray.forEach((function(c,r){j.fundRaisingDateMap[c]&&j.orderCountDateMap[c]&&b.fundRaisingSpendDaily[r]?(e+=j.fundRaisingDateMap[c],a.push(j.fundRaisingDateMap[c]),t+=j.orderCountDateMap[c],n.push(j.orderCountDateMap[c]),l.push((j.fundRaisingDateMap[c]/b.fundRaisingSpendDaily[r]).toFixed(1))):(n.push(null),a.push(null),l.push(null))})),y((function(c){c.fundRaisingTotal=e,c.fundRaisingDaily=a,c.orderCountTotal=t,c.orderCountDaily=n,c.totalRoasDaily=l}))}}),[j.fundRaisingDateMap,j.orderCountDateMap,b.fundRaisingSpendDaily,b.dateArray,y]),l.a.createElement("div",{className:"container my-3"},r?l.a.createElement("div",{className:"text-center my-5"},l.a.createElement("div",{className:"spinner-border text-primary",role:"status"},l.a.createElement("span",{className:"sr-only"},"Loading..."))):l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"btn btn-primary",onClick:function(){return Object(o.b)("/facebook-ad-account-dashboard/")}},"Home"),l.a.createElement("h1",{className:"text-center my-3"},b.name),j.name?l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-12 col-md-6"},l.a.createElement("div",{style:{margin:"0 auto",maxWidth:"480px"}},l.a.createElement("div",{style:{paddingTop:"56.25%",backgroundImage:"url(".concat(j.og_image,")"),backgroundSize:"cover",backgroundPosition:"center"}}))),l.a.createElement("div",{className:"col-12 col-md-6 p-3"},l.a.createElement("p",null,l.a.createElement("a",{href:"https://www.zeczec.com/projects/"+b.projectId,target:"blank"},j.name)),l.a.createElement("h3",null,j.funding_current),l.a.createElement("hr",null),l.a.createElement("p",null,l.a.createElement("span",{className:"font-weight-bolder mr-3"},"\u76ee\u6a19"),l.a.createElement("span",{className:"text-secondary"},j.funding_target)),l.a.createElement("p",null,l.a.createElement("span",{className:"font-weight-bolder mr-3"},"\u8d0a\u52a9\u4eba\u6578"),l.a.createElement("span",{className:"text-secondary"},j.sponsor_count)),l.a.createElement("p",null,l.a.createElement("span",{className:"font-weight-bolder mr-3"},"\u6642\u7a0b"),l.a.createElement("span",{className:"text-secondary"},j.started_at," ~ ",j.finished_at)))):"",l.a.createElement("div",{className:"my-5",style:{height:"300px"}},l.a.createElement(h.a,{data:R,options:N})),l.a.createElement("div",{className:"my-5",style:{height:"300px"}},l.a.createElement(h.a,{data:w,options:N})),l.a.createElement("div",{className:"table-responsive"},l.a.createElement("div",{className:"tableFixHead"},l.a.createElement("table",{className:"table"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",{scope:"col"},"Date"),l.a.createElement("th",{scope:"col"},"\u524d\u6e2c\u82b1\u8cbb"),l.a.createElement("th",{scope:"col"},"\u540d\u55ae\u6578"),l.a.createElement("th",{scope:"col"},"CPL"),l.a.createElement("th",{scope:"col"},"\u9810\u71b1\u82b1\u8cbb"),l.a.createElement("th",{scope:"col"},"\u4e0a\u7dda\u82b1\u8cbb"),l.a.createElement("th",{scope:"col"},"\u5ee3\u544a\u76f4\u63a5\u8f49\u63db\u91d1\u984d"),l.a.createElement("th",{scope:"col"},"\u5ee3\u544a\u76f4\u63a5 ROAS"),l.a.createElement("th",{scope:"col"},"\u6bcf\u65e5\u8a02\u55ae\u6578"),l.a.createElement("th",{scope:"col"},"\u6bcf\u65e5\u96c6\u8cc7\u91d1\u984d"),l.a.createElement("th",{scope:"col"},"\u7e3d\u9ad4 ROAS")),l.a.createElement("tr",null,l.a.createElement("td",null,"\u7e3d\u8a08"),l.a.createElement("td",null,d(b.leadSpendTotal).toDollar()),l.a.createElement("td",null,d(b.leadTotal).toNumber()),l.a.createElement("td",null,(b.leadSpendTotal/b.leadTotal).toFixed(1)),l.a.createElement("td",null,d(b.preLaunchSpendTotal).toDollar()),l.a.createElement("td",null,d(b.fundRaisingSpendTotal).toDollar()),l.a.createElement("td",null,d(b.adsDirectFundRaisingTotal).toDollar()),l.a.createElement("td",null,(b.adsDirectFundRaisingTotal/b.fundRaisingSpendTotal).toFixed(1)),l.a.createElement("td",null,d(b.orderCountTotal).toNumber()),l.a.createElement("td",null,d(b.fundRaisingTotal).toDollar()),l.a.createElement("td",null,(b.fundRaisingTotal/b.fundRaisingSpendTotal).toFixed(1)))),l.a.createElement("tbody",null,b.dateArray.map((function(e,a){return l.a.createElement("tr",{key:"daily-adAccount-data-".concat(a)},l.a.createElement("th",null,e),l.a.createElement("td",null,d(b.leadSpendDaily[a]).toDollar()),l.a.createElement("td",null,d(b.leadDaily[a]).toNumber()),l.a.createElement("td",null,d(b.costPerLeadDaily[a]).toDollar()),l.a.createElement("td",null,d(b.preLaunchSpendDaily[a]).toDollar()),l.a.createElement("td",null,d(b.fundRaisingSpendDaily[a]).toDollar()),l.a.createElement("td",null,d(b.adsDirectFundRaisingDaily[a]).toDollar()),l.a.createElement("td",null,b.adsDirectRoasDaily[a]),l.a.createElement("td",null,b.orderCountDaily[a]),l.a.createElement("td",null,d(b.fundRaisingDaily[a]).toDollar()),l.a.createElement("td",null,b.totalRoasDaily[a]))}))))))))},b=function(){return l.a.createElement(o.a,{basepath:"/facebook-ad-account-dashboard",primary:!1},l.a.createElement(p,{path:"/"}),l.a.createElement(E,{path:"/ad-account/:adAccountId"}))};t(206);r.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(b,null)),document.getElementById("root"))}},[[100,1,2]]]);
//# sourceMappingURL=main.48c5163e.chunk.js.map